import{r,a9 as g,j as e,L as k,a3 as L,ah as x,P as F,J as q,aK as D,a1 as R,aL as E}from"./index-BOMQ6ZnB.js";const P=()=>{const[l,j]=r.useState([]),[b,o]=r.useState(!0),[c,y]=r.useState(""),[d,N]=r.useState("all"),[f,i]=r.useState(!1),[s,n]=r.useState({request_number:`MR-${new Date().getFullYear()}-${String(Math.floor(Math.random()*9999)).padStart(4,"0")}`,title:"",description:"",request_type:"corrective",priority:"medium",target_completion:"",estimated_cost:0});r.useEffect(()=>{m()},[]);const m=async()=>{o(!0);const{data:t,error:a}=await g.from("om_maintenance_requests").select(`
                *,
                asset:om_assets(name_ar, asset_code)
            `).order("created_at",{ascending:!1});a||j(t||[]),o(!1)},v=async t=>{t.preventDefault();const{error:a}=await g.from("om_maintenance_requests").insert([s]);a||(i(!1),m())},h={corrective:"تصحيحية",preventive:"وقائية",emergency:"طارئة",improvement:"تحسينية"},u={low:"منخفضة",medium:"متوسطة",high:"عالية",critical:"حرجة"},w={pending:"قيد الانتظار",approved:"معتمد",in_progress:"قيد التنفيذ",on_hold:"معلق",completed:"مكتمل",cancelled:"ملغي",rejected:"مرفوض"},_=t=>{switch(t){case"critical":return"bg-red-100 text-red-800";case"high":return"bg-orange-100 text-orange-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},S=t=>{switch(t){case"completed":return"bg-green-100 text-green-800";case"in_progress":return"bg-blue-100 text-blue-800";case"pending":return"bg-yellow-100 text-yellow-800";case"cancelled":case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},p=l.filter(t=>{const a=t.title.includes(c)||t.request_number.includes(c),C=d==="all"||t.status===d;return a&&C});return e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(k,{to:"/operations",className:"flex items-center gap-2 text-gray-500 hover:text-gray-700 mb-2",children:[e.jsx(L,{className:"w-4 h-4"}),"العودة للتشغيل والصيانة"]}),e.jsxs("h1",{className:"text-2xl font-bold text-hrsd-primary flex items-center gap-3",children:[e.jsx(x,{className:"w-7 h-7"}),"طلبات الصيانة"]}),e.jsx("p",{className:"text-gray-500 mt-1",children:"إدارة وتتبع طلبات الصيانة والإصلاح"})]}),e.jsxs("button",{onClick:()=>i(!0),className:"px-4 py-2 bg-hrsd-primary text-white rounded-lg hover:bg-hrsd-primary/90 flex items-center gap-2 shadow-lg",children:[e.jsx(F,{className:"w-5 h-5"}),"طلب صيانة جديد"]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-4 flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"flex-1 min-w-[250px] relative",children:[e.jsx(q,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"البحث بالعنوان أو رقم الطلب...",value:c,onChange:t=>y(t.target.value),className:"w-full pr-10 pl-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-hrsd-primary"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5 text-gray-400"}),e.jsxs("select",{value:d,onChange:t=>N(t.target.value),className:"px-4 py-2 border border-gray-200 rounded-lg",children:[e.jsx("option",{value:"all",children:"جميع الحالات"}),e.jsx("option",{value:"pending",children:"قيد الانتظار"}),e.jsx("option",{value:"approved",children:"معتمد"}),e.jsx("option",{value:"in_progress",children:"قيد التنفيذ"}),e.jsx("option",{value:"completed",children:"مكتمل"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-5 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:l.length}),e.jsx("p",{className:"text-sm text-gray-500",children:"إجمالي الطلبات"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:l.filter(t=>t.status==="pending").length}),e.jsx("p",{className:"text-sm text-gray-500",children:"قيد الانتظار"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-indigo-600",children:l.filter(t=>t.status==="in_progress").length}),e.jsx("p",{className:"text-sm text-gray-500",children:"قيد التنفيذ"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:l.filter(t=>t.status==="completed").length}),e.jsx("p",{className:"text-sm text-gray-500",children:"مكتملة"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-red-600",children:l.filter(t=>t.priority==="critical").length}),e.jsx("p",{className:"text-sm text-gray-500",children:"حرجة"})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-md overflow-hidden",children:b?e.jsx("div",{className:"p-8 text-center text-gray-400",children:"جاري التحميل..."}):p.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-400",children:[e.jsx(x,{className:"w-16 h-16 mx-auto mb-4 opacity-30"}),e.jsx("p",{children:"لا توجد طلبات صيانة"})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 text-sm",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 text-right",children:"رقم الطلب"}),e.jsx("th",{className:"p-4 text-right",children:"العنوان"}),e.jsx("th",{className:"p-4 text-center",children:"النوع"}),e.jsx("th",{className:"p-4 text-center",children:"الأولوية"}),e.jsx("th",{className:"p-4 text-center",children:"الحالة"}),e.jsx("th",{className:"p-4 text-right",children:"التاريخ"}),e.jsx("th",{className:"p-4 text-center",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:p.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"p-4 font-mono text-sm",children:t.request_number}),e.jsxs("td",{className:"p-4",children:[e.jsx("div",{className:"font-medium",children:t.title}),e.jsx("div",{className:"text-sm text-gray-500 truncate max-w-xs",children:t.description})]}),e.jsx("td",{className:"p-4 text-center",children:e.jsx("span",{className:"px-2 py-1 bg-gray-100 rounded text-sm",children:h[t.request_type]})}),e.jsx("td",{className:"p-4 text-center",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${_(t.priority)}`,children:u[t.priority]})}),e.jsx("td",{className:"p-4 text-center",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${S(t.status)}`,children:w[t.status]})}),e.jsx("td",{className:"p-4 text-sm text-gray-500",children:new Date(t.reported_date).toLocaleDateString("ar-SA")}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{className:"p-2 hover:bg-gray-100 rounded-lg text-blue-600",children:e.jsx(R,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-2 hover:bg-gray-100 rounded-lg text-amber-600",children:e.jsx(E,{className:"w-4 h-4"})})]})})]},t.id))})]})}),f&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-8 max-w-2xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-auto",children:[e.jsxs("h2",{className:"text-xl font-bold mb-6 flex items-center gap-2",children:[e.jsx(x,{className:"w-6 h-6 text-hrsd-primary"}),"طلب صيانة جديد"]}),e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"رقم الطلب"}),e.jsx("input",{type:"text",value:s.request_number,readOnly:!0,className:"w-full px-4 py-2 border rounded-lg bg-gray-50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"عنوان الطلب *"}),e.jsx("input",{type:"text",value:s.title,onChange:t=>n({...s,title:t.target.value}),placeholder:"مثال: إصلاح مكيف غرفة 101",className:"w-full px-4 py-2 border rounded-lg",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"الوصف"}),e.jsx("textarea",{value:s.description,onChange:t=>n({...s,description:t.target.value}),className:"w-full px-4 py-2 border rounded-lg",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"نوع الصيانة"}),e.jsx("select",{value:s.request_type,onChange:t=>n({...s,request_type:t.target.value}),className:"w-full px-4 py-2 border rounded-lg",children:Object.entries(h).map(([t,a])=>e.jsx("option",{value:t,children:a},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"الأولوية"}),e.jsx("select",{value:s.priority,onChange:t=>n({...s,priority:t.target.value}),className:"w-full px-4 py-2 border rounded-lg",children:Object.entries(u).map(([t,a])=>e.jsx("option",{value:t,children:a},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"تاريخ الإنجاز المتوقع"}),e.jsx("input",{type:"date",value:s.target_completion,onChange:t=>n({...s,target_completion:t.target.value}),className:"w-full px-4 py-2 border rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"التكلفة التقديرية"}),e.jsx("input",{type:"number",value:s.estimated_cost,onChange:t=>n({...s,estimated_cost:parseFloat(t.target.value)}),className:"w-full px-4 py-2 border rounded-lg"})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:()=>i(!1),className:"px-6 py-2 bg-gray-100 rounded-lg hover:bg-gray-200",children:"إلغاء"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-hrsd-primary text-white rounded-lg hover:bg-hrsd-primary/90",children:"إرسال الطلب"})]})]})]})})]})};export{P as MaintenanceRequests,P as default};
