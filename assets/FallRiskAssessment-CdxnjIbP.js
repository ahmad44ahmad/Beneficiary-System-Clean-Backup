import{r as n,j as e,au as y,n as v,av as N,A as w,T as k,q as S,a9 as F}from"./index-BOMQ6ZnB.js";const A=({beneficiaryName:b,beneficiaryId:u,onSave:o})=>{const[i,d]=n.useState(!1),[c,x]=n.useState(""),[g,h]=n.useState(""),[a,t]=n.useState({historyOfFalls:!1,secondaryDiagnosis:!1,ambulatoryAid:"none",ivTherapy:!1,gait:"normal",mentalStatus:"oriented"}),p=()=>{let s=0;return a.historyOfFalls&&(s+=25),a.secondaryDiagnosis&&(s+=15),a.ambulatoryAid==="crutches"?s+=15:a.ambulatoryAid==="furniture"&&(s+=30),a.ivTherapy&&(s+=20),a.gait==="weak"?s+=10:a.gait==="impaired"&&(s+=20),a.mentalStatus==="forgets"&&(s+=15),s},j=s=>s<25?{label:"منخفض (Low Risk)",value:"low",color:"text-green-600",bg:"bg-green-100",border:"border-green-200"}:s<51?{label:"متوسط (Medium Risk)",value:"medium",color:"text-yellow-600",bg:"bg-yellow-100",border:"border-yellow-200"}:{label:"عالي (High Risk)",value:"high",color:"text-red-600",bg:"bg-red-100",border:"border-red-200"},r=p(),l=j(r),f=async()=>{d(!0),h(""),x("");try{const s={beneficiary_id:u,assessment_date:new Date().toISOString().split("T")[0],risk_score:r,risk_level:l.value,history_of_falls:a.historyOfFalls,secondary_diagnosis:a.secondaryDiagnosis,ambulatory_aid:a.ambulatoryAid,iv_therapy:a.ivTherapy,gait:a.gait,mental_status:a.mentalStatus,assessed_by:null},{error:m}=await F.from("fall_risk_assessments").insert(s);if(m)throw m;x("تم حفظ تقييم المخاطر بنجاح"),o&&o(s)}catch(s){console.error("Error saving assessment:",s),h(s.message||"حدث خطأ أثناء الحفظ")}finally{d(!1)}};return e.jsxs("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden border border-orange-100 font-readex",dir:"rtl",children:[e.jsxs("div",{className:"bg-gradient-to-l from-orange-600 to-amber-600 p-6 text-white flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(y,{className:"h-6 w-6"}),"الحارس الذكي - تقييم مخاطر السقوط"]}),e.jsxs("p",{className:"opacity-90 mt-1 text-sm",children:["تقييم مورس (Morse Fall Scale) - ",b]})]}),c&&e.jsxs("div",{className:"bg-white/20 px-4 py-2 rounded-lg flex items-center gap-2 animate-pulse",children:[e.jsx(v,{className:"w-5 h-5"}),c]})]}),e.jsxs("div",{className:"p-6 grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"md:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-orange-50/50 p-4 rounded-lg border border-orange-100",children:[e.jsxs("h3",{className:"font-bold text-gray-800 mb-3 flex items-center gap-2 border-b border-orange-200 pb-2",children:[e.jsx(N,{className:"h-5 w-5 text-orange-500"}),"1. التاريخ والمناولة"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded border cursor-pointer transition-all ${a.historyOfFalls?"bg-orange-50 border-orange-300":"bg-white hover:border-orange-300"}`,children:[e.jsx("input",{type:"checkbox",checked:a.historyOfFalls,onChange:s=>t({...a,historyOfFalls:s.target.checked}),className:"w-5 h-5 text-orange-600 rounded focus:ring-orange-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-900 font-medium block",children:"تاريخ سابق للسقوط"}),e.jsx("span",{className:"text-gray-500 text-sm",children:"هل سقط المستفيد خلال الثلاثة أشهر الماضية؟ (+25)"})]})]}),e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded border cursor-pointer transition-all ${a.secondaryDiagnosis?"bg-orange-50 border-orange-300":"bg-white hover:border-orange-300"}`,children:[e.jsx("input",{type:"checkbox",checked:a.secondaryDiagnosis,onChange:s=>t({...a,secondaryDiagnosis:s.target.checked}),className:"w-5 h-5 text-orange-600 rounded focus:ring-orange-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-900 font-medium block",children:"وجود تشخيص ثانوي"}),e.jsx("span",{className:"text-gray-500 text-sm",children:"هل يوجد أكثر من تشخيص طبي في الملف؟ (+15)"})]})]}),e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded border cursor-pointer transition-all ${a.ivTherapy?"bg-orange-50 border-orange-300":"bg-white hover:border-orange-300"}`,children:[e.jsx("input",{type:"checkbox",checked:a.ivTherapy,onChange:s=>t({...a,ivTherapy:s.target.checked}),className:"w-5 h-5 text-orange-600 rounded focus:ring-orange-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-900 font-medium block",children:"علاج وريدي (IV / Heparin Lock)"}),e.jsx("span",{className:"text-gray-500 text-sm",children:"هل يستخدم المغذي أو إبرة مميعة؟ (+20)"})]})]})]})]}),e.jsxs("div",{className:"bg-orange-50/50 p-4 rounded-lg border border-orange-100",children:[e.jsxs("h3",{className:"font-bold text-gray-800 mb-3 flex items-center gap-2 border-b border-orange-200 pb-2",children:[e.jsx(w,{className:"h-5 w-5 text-orange-500"}),"2. الحركة والمساعدة"]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"3. أداة المساعدة في المشي"}),e.jsxs("select",{value:a.ambulatoryAid,onChange:s=>t({...a,ambulatoryAid:s.target.value}),className:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-orange-500 outline-none bg-white",children:[e.jsx("option",{value:"none",children:"لا يوجد / كرسي متحرك / مساعدة تمريضية (0)"}),e.jsx("option",{value:"crutches",children:"عكاز / عصا / مشاية (15)"}),e.jsx("option",{value:"furniture",children:"يتكأ على الأثاث والجدران (30)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"5. المشية / التنقل (Gait)"}),e.jsxs("select",{value:a.gait,onChange:s=>t({...a,gait:s.target.value}),className:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-orange-500 outline-none bg-white",children:[e.jsx("option",{value:"normal",children:"طبيعية / طريح فراش / كرسي متحرك كلي (0)"}),e.jsx("option",{value:"weak",children:"ضعيفة (انحناء بسيط، خطوات قصيرة) (10)"}),e.jsx("option",{value:"impaired",children:"مضطربة (صعوبة نهوض، ترنح) (20)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"6. الحالة الذهنية"}),e.jsxs("select",{value:a.mentalStatus,onChange:s=>t({...a,mentalStatus:s.target.value}),className:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-orange-500 outline-none bg-white",children:[e.jsx("option",{value:"oriented",children:"مدرك لقدراته وحدوده (0)"}),e.jsx("option",{value:"forgets",children:"ينسى حدوده / يبالغ في تقدير قدرته (15)"})]})]})]})]})]}),e.jsx("div",{className:"md:col-span-1",children:e.jsxs("div",{className:`p-6 rounded-xl border-2 ${l.bg} ${l.border} h-full flex flex-col justify-between sticky top-4`,children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-gray-700",children:"مجموع النقاط"}),e.jsx("div",{className:`text-5xl font-black ${l.color} mb-2 tracking-tighter`,children:r}),e.jsx("div",{className:`inline-block px-4 py-1.5 rounded-full text-sm font-bold bg-white ${l.color} shadow-sm border`,children:l.label})]}),e.jsxs("div",{className:"mt-8",children:[e.jsxs("h4",{className:"font-bold text-gray-800 mb-3 text-sm flex items-center gap-2",children:[e.jsx(k,{className:"w-4 h-4 text-gray-600"}),"الإجراءات الموصى بها:"]}),e.jsxs("div",{className:"bg-white/60 rounded-lg p-3 text-sm text-gray-700 space-y-2 border border-gray-100",children:[r>=51&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-start gap-2 text-red-700 font-bold",children:[e.jsx("span",{children:"•"}),e.jsx("span",{children:"تفعيل بروتوكول السقوط العالي فوراً"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{children:"•"}),e.jsx("span",{children:"مرافقة عند دخول الحمام"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{children:"•"}),e.jsx("span",{children:"وضع سوار أصفر للمستفيد"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{children:"•"}),e.jsx("span",{children:"رفع حواجز السرير دائماً"})]})]}),r>=25&&r<51&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-start gap-2 text-yellow-800 font-bold",children:[e.jsx("span",{children:"•"}),e.jsx("span",{children:"تفعيل إجراءات الوقاية القياسية"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{children:"•"}),e.jsx("span",{children:"مراجعة الأدوية المسببة للدوار"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{children:"•"}),e.jsx("span",{children:"توفير إضاءة ليلية خافتة"})]})]}),r<25&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-start gap-2 text-green-700 font-bold",children:[e.jsx("span",{children:"•"}),e.jsx("span",{children:"الرعاية التمريضية الأساسية"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{children:"•"}),e.jsx("span",{children:"تقييم دوري شهرياً"})]})]})]})]}),g&&e.jsx("p",{className:"text-red-500 text-sm mt-4 text-center font-medium bg-red-50 p-2 rounded",children:g}),e.jsx("button",{onClick:f,disabled:i,className:`w-full mt-6 py-3 bg-gradient-to-r from-orange-600 to-amber-600 text-white rounded-lg shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition-all flex items-center justify-center gap-2 font-bold ${i?"opacity-70 cursor-wait":""}`,children:i?"جاري الحفظ...":e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"h-5 w-5"}),"حفظ التقييم"]})})]})})]})]})};export{A as FallRiskAssessment};
