import{k as v,r as i,ah as j,A as f,aO as y,R as d,U as b,j as e,p as w,T as _,aN as N,a as k,a9 as C}from"./index-BOMQ6ZnB.js";import{a4 as D,a5 as S}from"./CategoricalChart-CVOu2Sdu.js";import{L as A}from"./LineChart-BCAJLlzb.js";import{C as L}from"./CartesianGrid-Dh6FfMw5.js";import{X as R,Y as E}from"./CartesianChart-BCPM_Iof.js";import{L as T}from"./Line-OmcAOY_B.js";import"./getRadiusAndStrokeWidthFromDot-DgyDVF4g.js";import"./ErrorBarContext-DeCBPfcE.js";const G=()=>{const m=v(),[x,c]=i.useState([]),[a,l]=i.useState(null),[h,o]=i.useState(!0),r=[{score_date:"2026-01-01",overdue_maintenance_count:3,fall_incidents_week:1,active_critical_alerts:2,critical_accountability_gaps:4,poor_condition_assets:5,total_risk_score:125,risk_level:"Ø£Ø­Ù…Ø±"},{score_date:"2026-01-02",overdue_maintenance_count:4,fall_incidents_week:0,active_critical_alerts:2,critical_accountability_gaps:4,poor_condition_assets:5,total_risk_score:115,risk_level:"Ø£Ø­Ù…Ø±"},{score_date:"2026-01-03",overdue_maintenance_count:4,fall_incidents_week:1,active_critical_alerts:3,critical_accountability_gaps:4,poor_condition_assets:5,total_risk_score:140,risk_level:"Ø£Ø­Ù…Ø±"},{score_date:"2026-01-04",overdue_maintenance_count:5,fall_incidents_week:1,active_critical_alerts:3,critical_accountability_gaps:4,poor_condition_assets:5,total_risk_score:145,risk_level:"Ø£Ø­Ù…Ø±"},{score_date:"2026-01-05",overdue_maintenance_count:5,fall_incidents_week:2,active_critical_alerts:4,critical_accountability_gaps:4,poor_condition_assets:5,total_risk_score:170,risk_level:"Ø£Ø­Ù…Ø±"},{score_date:"2026-01-06",overdue_maintenance_count:6,fall_incidents_week:2,active_critical_alerts:4,critical_accountability_gaps:4,poor_condition_assets:6,total_risk_score:188,risk_level:"Ø£Ø­Ù…Ø±"},{score_date:"2026-01-07",overdue_maintenance_count:6,fall_incidents_week:0,active_critical_alerts:3,critical_accountability_gaps:4,poor_condition_assets:6,total_risk_score:143,risk_level:"Ø£Ø­Ù…Ø±"},{score_date:"2026-01-08",overdue_maintenance_count:5,fall_incidents_week:0,active_critical_alerts:2,critical_accountability_gaps:3,poor_condition_assets:6,total_risk_score:103,risk_level:"Ø£Ø­Ù…Ø±"},{score_date:"2026-01-09",overdue_maintenance_count:4,fall_incidents_week:1,active_critical_alerts:2,critical_accountability_gaps:3,poor_condition_assets:5,total_risk_score:105,risk_level:"Ø£Ø­Ù…Ø±"}];i.useEffect(()=>{(async()=>{o(!0);const{data:s,error:u}=await C.from("risk_score_log").select("*").order("score_date",{ascending:!0}).limit(14);u||!s||s.length===0?(c(r),l(r[r.length-1])):(c(s),l(s[s.length-1])),o(!1)})()},[]);const n=t=>{switch(t){case"Ø£Ø­Ù…Ø±":return"from-red-600 to-red-700";case"Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ":return"from-orange-500 to-orange-600";case"Ø£ØµÙØ±":return"from-yellow-500 to-yellow-600";default:return"from-hrsd-green to-hrsd-green-dark"}},g=a?[{icon:j,label:"ØµÙŠØ§Ù†Ø© Ù…ØªØ£Ø®Ø±Ø©",value:a.overdue_maintenance_count,weight:5,color:"text-orange-600"},{icon:f,label:"Ø­ÙˆØ§Ø¯Ø« Ø³Ù‚ÙˆØ·",value:a.fall_incidents_week,weight:10,color:"text-red-600"},{icon:y,label:"ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø­Ø±Ø¬Ø©",value:a.active_critical_alerts,weight:15,color:"text-red-700"},{icon:d,label:"ÙØ¬ÙˆØ§Øª Ù…Ø³Ø§Ø¡Ù„Ø©",value:a.critical_accountability_gaps,weight:20,color:"text-purple-600"},{icon:b,label:"Ø£ØµÙˆÙ„ Ø¨Ø­Ø§Ù„Ø© Ø³ÙŠØ¦Ø©",value:a.poor_condition_assets,weight:3,color:"text-gray-600"}].sort((t,s)=>s.value*s.weight-t.value*t.weight):[],p=[{priority:1,action:"Ø¥ØµÙ„Ø§Ø­ Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø© Ø§Ù„Ù…ØªØ£Ø®Ø±Ø© ÙÙˆØ±Ø§Ù‹",impact:"Ø®ÙØ¶ 20 Ù†Ù‚Ø·Ø©"},{priority:2,action:"Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ÙØ¬ÙˆØ§Øª Ø§Ù„Ø­Ø±Ø¬Ø© Ù…Ø¹ Ø§Ù„ÙˆØ²Ø§Ø±Ø©",impact:"Ø®ÙØ¶ 60 Ù†Ù‚Ø·Ø©"},{priority:3,action:"Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ Ù…Ù†Ø¹ Ø§Ù„Ø³Ù‚ÙˆØ·",impact:"Ø®ÙØ¶ 10 Ù†Ù‚Ø§Ø·"}];return e.jsxs("div",{className:"min-h-screen bg-gray-50 p-6",dir:"rtl",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("button",{onClick:()=>m(-1),className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(w,{className:"w-5 h-5"})}),e.jsx("div",{className:`p-3 bg-gradient-to-br ${a?n(a.risk_level):"from-gray-500 to-gray-600"} rounded-xl`,children:e.jsx(_,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-hierarchy-title text-gray-900",children:"Ù…Ø¤Ø´Ø± Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ Ø§Ù„ÙˆÙ‚Ø§Ø¦ÙŠ"}),e.jsx("p",{className:"text-hierarchy-small text-gray-500",children:"Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ù†Ø°Ø§Ø± Ø§Ù„Ù…Ø¨ÙƒØ± Ù„Ù„ÙƒÙˆØ§Ø±Ø« Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©"})]}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mr-auto p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(N,{className:"w-5 h-5 text-gray-500"})})]})}),h?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-hrsd-teal"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`bg-gradient-to-r ${a?n(a.risk_level):""} rounded-2xl p-6 text-white mb-6`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø·Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ"}),e.jsx("p",{className:"text-5xl font-bold",children:(a==null?void 0:a.total_risk_score)||0}),e.jsx("p",{className:"text-xl mt-1",children:"Ù†Ù‚Ø·Ø©"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-white/20 flex items-center justify-center",children:e.jsx(_,{className:"w-12 h-12"})}),e.jsx("p",{className:"mt-2 text-lg font-bold",children:(a==null?void 0:a.risk_level)||"ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"})]}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-white/80 text-sm",children:"Ø§Ù„Ù…Ø¹ÙŠØ§Ø±"}),e.jsxs("div",{className:"space-y-1 mt-2 text-sm",children:[e.jsx("p",{children:"0-30: Ø£Ø®Ø¶Ø± âœ…"}),e.jsx("p",{children:"31-60: Ø£ØµÙØ± âš ï¸"}),e.jsx("p",{children:"61-90: Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ ðŸŸ "}),e.jsx("p",{children:">90: Ø£Ø­Ù…Ø± ðŸ”´"})]})]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-6",children:g.map((t,s)=>e.jsxs("div",{className:"hrsd-card text-center",children:[e.jsx(t.icon,{className:`w-8 h-8 mx-auto mb-2 ${t.color}`}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:t.value}),e.jsx("p",{className:"text-hierarchy-small text-gray-500",children:t.label}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Ã—",t.weight," = ",t.value*t.weight," Ù†Ù‚Ø·Ø©"]})]},s))}),e.jsxs("div",{className:"hrsd-card mb-6",children:[e.jsxs("h3",{className:"text-hierarchy-subheading text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5 text-hrsd-teal"}),"Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù…Ø®Ø§Ø·Ø± (Ø¢Ø®Ø± 14 ÙŠÙˆÙ…)"]}),e.jsx(D,{width:"100%",height:250,children:e.jsxs(A,{data:x,children:[e.jsx(L,{strokeDasharray:"3 3"}),e.jsx(R,{dataKey:"score_date",tickFormatter:t=>new Date(t).toLocaleDateString("ar-SA",{day:"numeric",month:"short"})}),e.jsx(E,{}),e.jsx(S,{labelFormatter:t=>new Date(t).toLocaleDateString("ar-SA"),formatter:t=>[`${t} Ù†Ù‚Ø·Ø©`,"Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø·Ø±"]}),e.jsx(T,{type:"monotone",dataKey:"total_risk_score",stroke:"#ef4444",strokeWidth:3,dot:{fill:"#ef4444",strokeWidth:2}})]})})]}),e.jsxs("div",{className:"hrsd-card",children:[e.jsxs("h3",{className:"text-hierarchy-subheading text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(d,{className:"w-5 h-5 text-hrsd-green"}),"ØªÙˆØµÙŠØ§Øª ÙˆÙ‚Ø§Ø¦ÙŠØ© ÙÙˆØ±ÙŠØ©"]}),e.jsx("div",{className:"space-y-3",children:p.map((t,s)=>e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-hrsd-teal text-white flex items-center justify-center font-bold",children:t.priority}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"font-medium text-gray-900",children:t.action})}),e.jsx("span",{className:"badge-success",children:t.impact})]},s))})]})]})]})};export{G as EarlyWarningSystem,G as default};
