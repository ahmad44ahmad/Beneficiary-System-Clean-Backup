import{r as d,a9 as j,j as e,L as _,a3 as S,ao as n,P as k,aM as q,T as C,F as D,q as T}from"./index-BOMQ6ZnB.js";const L=()=>{const[i,b]=d.useState([]),[v,m]=d.useState(!0),[N,o]=d.useState(!1),[a,t]=d.useState({record_date:new Date().toISOString().split("T")[0],waste_type:"general",source_location:"",quantity:0,unit:"kg",disposal_method:"landfill",contractor_name:"",notes:""});d.useEffect(()=>{h()},[]);const h=async()=>{m(!0);const{data:s,error:l}=await j.from("om_waste_records").select("*").order("record_date",{ascending:!1}).limit(50);l||b(s||[]),m(!1)},y=async s=>{s.preventDefault();const{error:l}=await j.from("om_waste_records").insert([a]);l||(o(!1),h(),t({record_date:new Date().toISOString().split("T")[0],waste_type:"general",source_location:"",quantity:0,unit:"kg",disposal_method:"landfill",contractor_name:"",notes:""}))},x=[{value:"general",label:"نفايات عامة",color:"bg-gray-500"},{value:"recyclable",label:"قابلة للتدوير",color:"bg-green-500"},{value:"hazardous",label:"خطرة",color:"bg-red-500"},{value:"electronic",label:"إلكترونية",color:"bg-blue-500"},{value:"confidential",label:"سرية",color:"bg-purple-500"}],u=[{value:"landfill",label:"ردم"},{value:"recycling",label:"إعادة تدوير"},{value:"incineration",label:"حرق"},{value:"special_treatment",label:"معالجة خاصة"},{value:"reuse",label:"إعادة استخدام"}],f=new Date().toISOString().slice(0,7),c=i.filter(s=>s.record_date.startsWith(f)),w=c.reduce((s,l)=>s+(l.quantity||0),0);return e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(_,{to:"/operations",className:"flex items-center gap-2 text-gray-500 hover:text-gray-700 mb-2",children:[e.jsx(S,{className:"w-4 h-4"}),"العودة للتشغيل والصيانة"]}),e.jsxs("h1",{className:"text-2xl font-bold text-hrsd-primary flex items-center gap-3",children:[e.jsx(n,{className:"w-7 h-7"}),"إدارة المخلفات"]}),e.jsx("p",{className:"text-gray-500 mt-1",children:"تتبع وتوثيق جميع أنواع المخلفات"})]}),e.jsxs("button",{onClick:()=>o(!0),className:"px-4 py-2 bg-hrsd-primary text-white rounded-lg hover:bg-hrsd-primary/90 flex items-center gap-2 shadow-lg",children:[e.jsx(k,{className:"w-5 h-5"}),"تسجيل مخلفات"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white rounded-xl p-5 shadow-md",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-gray-100 rounded-lg",children:e.jsx(n,{className:"w-6 h-6 text-gray-600"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-bold",children:[w," كجم"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"إجمالي هذا الشهر"})]})]})}),e.jsx("div",{className:"bg-white rounded-xl p-5 shadow-md",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:e.jsx(q,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-bold",children:[c.filter(s=>s.waste_type==="recyclable").reduce((s,l)=>s+l.quantity,0)," كجم"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"مُعاد تدويرها"})]})]})}),e.jsx("div",{className:"bg-white rounded-xl p-5 shadow-md",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-red-100 rounded-lg",children:e.jsx(C,{className:"w-6 h-6 text-red-600"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-bold",children:[c.filter(s=>s.waste_type==="hazardous").reduce((s,l)=>s+l.quantity,0)," كجم"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"مخلفات خطرة"})]})]})}),e.jsx("div",{className:"bg-white rounded-xl p-5 shadow-md",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:e.jsx(D,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:c.length}),e.jsx("p",{className:"text-sm text-gray-500",children:"عدد السجلات"})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-md overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-100",children:e.jsx("h2",{className:"font-bold text-lg",children:"سجل المخلفات"})}),v?e.jsx("div",{className:"p-8 text-center text-gray-400",children:"جاري التحميل..."}):i.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-400",children:[e.jsx(n,{className:"w-16 h-16 mx-auto mb-4 opacity-30"}),e.jsx("p",{children:"لا توجد سجلات"})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 text-sm",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 text-right",children:"التاريخ"}),e.jsx("th",{className:"p-3 text-right",children:"النوع"}),e.jsx("th",{className:"p-3 text-right",children:"المصدر"}),e.jsx("th",{className:"p-3 text-center",children:"الكمية"}),e.jsx("th",{className:"p-3 text-center",children:"طريقة التخلص"}),e.jsx("th",{className:"p-3 text-right",children:"المقاول"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:i.map(s=>{var l,p,g;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"p-3",children:new Date(s.record_date).toLocaleDateString("ar-SA")}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs text-white ${(l=x.find(r=>r.value===s.waste_type))==null?void 0:l.color}`,children:(p=x.find(r=>r.value===s.waste_type))==null?void 0:p.label})}),e.jsx("td",{className:"p-3",children:s.source_location}),e.jsxs("td",{className:"p-3 text-center font-medium",children:[s.quantity," ",s.unit]}),e.jsx("td",{className:"p-3 text-center",children:(g=u.find(r=>r.value===s.disposal_method))==null?void 0:g.label}),e.jsx("td",{className:"p-3",children:s.contractor_name||"-"})]},s.id)})})]})]}),N&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-8 max-w-2xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-auto",children:[e.jsxs("h2",{className:"text-xl font-bold mb-6 flex items-center gap-2",children:[e.jsx(n,{className:"w-6 h-6 text-hrsd-primary"}),"تسجيل مخلفات جديدة"]}),e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"التاريخ"}),e.jsx("input",{type:"date",value:a.record_date,onChange:s=>t({...a,record_date:s.target.value}),className:"w-full px-4 py-2 border rounded-lg",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"نوع المخلفات"}),e.jsx("select",{value:a.waste_type,onChange:s=>t({...a,waste_type:s.target.value}),className:"w-full px-4 py-2 border rounded-lg",children:x.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"مصدر المخلفات"}),e.jsx("input",{type:"text",value:a.source_location,onChange:s=>t({...a,source_location:s.target.value}),placeholder:"مثال: مبنى الإدارة",className:"w-full px-4 py-2 border rounded-lg"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"الكمية"}),e.jsx("input",{type:"number",value:a.quantity,onChange:s=>t({...a,quantity:parseFloat(s.target.value)}),className:"w-full px-4 py-2 border rounded-lg",required:!0})]}),e.jsxs("div",{className:"w-24",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"الوحدة"}),e.jsxs("select",{value:a.unit,onChange:s=>t({...a,unit:s.target.value}),className:"w-full px-4 py-2 border rounded-lg",children:[e.jsx("option",{value:"kg",children:"كجم"}),e.jsx("option",{value:"ton",children:"طن"}),e.jsx("option",{value:"liter",children:"لتر"}),e.jsx("option",{value:"unit",children:"وحدة"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"طريقة التخلص"}),e.jsx("select",{value:a.disposal_method,onChange:s=>t({...a,disposal_method:s.target.value}),className:"w-full px-4 py-2 border rounded-lg",children:u.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"اسم المقاول"}),e.jsx("input",{type:"text",value:a.contractor_name,onChange:s=>t({...a,contractor_name:s.target.value}),placeholder:"اختياري",className:"w-full px-4 py-2 border rounded-lg"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"ملاحظات"}),e.jsx("textarea",{value:a.notes,onChange:s=>t({...a,notes:s.target.value}),className:"w-full px-4 py-2 border rounded-lg",rows:3})]}),e.jsxs("div",{className:"flex gap-3 justify-end pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:()=>o(!1),className:"px-6 py-2 bg-gray-100 rounded-lg hover:bg-gray-200",children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"px-6 py-2 bg-hrsd-primary text-white rounded-lg hover:bg-hrsd-primary/90 flex items-center gap-2",children:[e.jsx(T,{className:"w-4 h-4"}),"حفظ"]})]})]})]})})]})};export{L as WasteManagement,L as default};
