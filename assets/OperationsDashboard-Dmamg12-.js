import{r as i,a9 as c,t as p,ah as u,a7 as D,T as L,ao as b,j as e,L as o,a3 as P,x as k,P as j,y as E,b as R,aF as B,c as F}from"./index-BOMQ6ZnB.js";const W=()=>{const[r,y]=i.useState({totalAssets:0,activeAssets:0,pendingMaintenance:0,completedThisMonth:0,overduePreventive:0,wasteThisMonth:0}),[m,h]=i.useState(!0),[g,N]=i.useState([]);i.useEffect(()=>{v()},[]);const v=async()=>{h(!0);const t=new Date,a=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-01`;try{const{data:l,count:S}=await c.from("om_assets").select("*",{count:"exact"}),A=(l==null?void 0:l.filter(s=>s.status==="active").length)||0,{data:n}=await c.from("om_maintenance_requests").select("*").order("created_at",{ascending:!1}).limit(5),M=(n==null?void 0:n.filter(s=>s.status==="pending"||s.status==="in_progress").length)||0,T=(n==null?void 0:n.filter(s=>s.status==="completed"&&s.completed_at>=a).length)||0,{data:d}=await c.from("om_preventive_schedules").select("*").lt("next_due_date",t.toISOString().split("T")[0]).eq("status","active"),{data:x}=await c.from("om_waste_records").select("quantity").gte("record_date",a),$=(x==null?void 0:x.reduce((s,C)=>s+(C.quantity||0),0))||0;y({totalAssets:S||0,activeAssets:A,pendingMaintenance:M,completedThisMonth:T,overduePreventive:(d==null?void 0:d.length)||0,wasteThisMonth:$}),N(n||[])}catch(l){console.error("Error fetching dashboard data:",l)}finally{h(!1)}},w=[{title:"إجمالي الأصول",value:r.totalAssets,subtitle:`${r.activeAssets} أصل نشط`,icon:p,color:"bg-blue-500",trend:null},{title:"طلبات الصيانة المعلقة",value:r.pendingMaintenance,subtitle:"بحاجة للمتابعة",icon:u,color:"bg-amber-500",trend:null},{title:"مكتملة هذا الشهر",value:r.completedThisMonth,subtitle:"طلب صيانة",icon:D,color:"bg-green-500",trend:"+12%"},{title:"صيانة وقائية متأخرة",value:r.overduePreventive,subtitle:"تحتاج إجراء فوري",icon:L,color:r.overduePreventive>0?"bg-red-500":"bg-slate-400",trend:null},{title:"المخلفات هذا الشهر",value:`${r.wasteThisMonth} كجم`,subtitle:"إجمالي النفايات",icon:b,color:"bg-purple-500",trend:"-5%"}],f=[{title:"طلب صيانة جديد",icon:j,link:"/operations/maintenance/new",color:"bg-hrsd-primary"},{title:"سجل الأصول",icon:p,link:"/operations/assets",color:"bg-blue-600"},{title:"الصيانة الوقائية",icon:R,link:"/operations/preventive",color:"bg-green-600"},{title:"إدارة المخلفات",icon:b,link:"/operations/waste",color:"bg-purple-600"},{title:"تقييم المقاولين",icon:B,link:"/operations/evaluations",color:"bg-amber-600"}],_=t=>{const a={pending:"bg-yellow-100 text-yellow-800",approved:"bg-blue-100 text-blue-800",in_progress:"bg-indigo-100 text-indigo-800",completed:"bg-green-100 text-green-800",cancelled:"bg-gray-100 text-gray-800"},l={pending:"قيد الانتظار",approved:"معتمد",in_progress:"قيد التنفيذ",completed:"مكتمل",cancelled:"ملغي"};return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${a[t]||"bg-gray-100"}`,children:l[t]||t})};return e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(o,{to:"/",className:"flex items-center gap-2 text-gray-500 hover:text-gray-700 mb-2",children:[e.jsx(P,{className:"w-4 h-4"}),"العودة للرئيسية"]}),e.jsxs("h1",{className:"text-3xl font-bold text-hrsd-primary flex items-center gap-3",children:[e.jsx(k,{className:"w-8 h-8"}),"وحدة التشغيل والصيانة"]}),e.jsx("p",{className:"text-gray-500 mt-1",children:"إدارة الأصول والصيانة والمخلفات"})]}),e.jsx("div",{className:"flex gap-3",children:e.jsxs(o,{to:"/operations/maintenance/new",className:"px-4 py-2 bg-hrsd-primary text-white rounded-lg hover:bg-hrsd-primary/90 flex items-center gap-2 shadow-lg",children:[e.jsx(j,{className:"w-5 h-5"}),"طلب صيانة جديد"]})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:w.map((t,a)=>e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-5 border border-gray-100 hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("div",{className:`p-3 rounded-lg ${t.color} text-white`,children:e.jsx(t.icon,{className:"w-6 h-6"})}),t.trend&&e.jsx("span",{className:`text-sm font-medium ${t.trend.startsWith("+")?"text-green-600":"text-red-600"}`,children:t.trend})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:m?"...":t.value}),e.jsx("p",{className:"text-sm text-gray-500",children:t.title}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:t.subtitle})]})]},a))}),e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6 border border-gray-100",children:[e.jsxs("h2",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5 text-hrsd-primary"}),"إجراءات سريعة"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:f.map((t,a)=>e.jsxs(o,{to:t.link,className:`${t.color} text-white rounded-xl p-4 text-center hover:opacity-90 transition-opacity shadow-md`,children:[e.jsx(t.icon,{className:"w-8 h-8 mx-auto mb-2"}),e.jsx("span",{className:"text-sm font-medium",children:t.title})]},a))})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5 text-hrsd-primary"}),"آخر طلبات الصيانة"]}),e.jsx(o,{to:"/operations/maintenance",className:"text-hrsd-primary hover:underline text-sm",children:"عرض الكل"})]}),m?e.jsx("div",{className:"text-center py-8 text-gray-400",children:"جاري التحميل..."}):g.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx(u,{className:"w-12 h-12 mx-auto mb-2 opacity-30"}),"لا توجد طلبات صيانة حتى الآن"]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 text-sm",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 text-right",children:"رقم الطلب"}),e.jsx("th",{className:"p-3 text-right",children:"العنوان"}),e.jsx("th",{className:"p-3 text-center",children:"النوع"}),e.jsx("th",{className:"p-3 text-center",children:"الأولوية"}),e.jsx("th",{className:"p-3 text-center",children:"الحالة"}),e.jsx("th",{className:"p-3 text-right",children:"التاريخ"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:g.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"p-3 font-mono text-sm",children:t.request_number}),e.jsx("td",{className:"p-3",children:t.title}),e.jsx("td",{className:"p-3 text-center text-sm",children:t.request_type}),e.jsx("td",{className:"p-3 text-center",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${t.priority==="critical"?"bg-red-100 text-red-800":t.priority==="high"?"bg-orange-100 text-orange-800":t.priority==="medium"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:t.priority})}),e.jsx("td",{className:"p-3 text-center",children:_(t.status)}),e.jsx("td",{className:"p-3 text-sm text-gray-500",children:new Date(t.created_at).toLocaleDateString("ar-SA")})]},t.id))})]})})]})]})};export{W as OperationsDashboard,W as default};
