import{r as n,a9 as k,j as e,L as C,a3 as S,a8 as m,P as $,F as L,a7 as h,O as o,V as p,aK as R}from"./index-BOMQ6ZnB.js";const t={gold:"rgb(250, 180, 20)",green:"rgb(45, 180, 115)",teal:"rgb(20, 130, 135)",navy:"rgb(20, 65, 90)"},F=()=>{const[g,u]=n.useState([]),[j,d]=n.useState(!0),[r,b]=n.useState("all"),[l,N]=n.useState({total:0,compliant:0,partial:0,nonCompliant:0,pending:0});n.useEffect(()=>{y()},[]);const y=async()=>{d(!0);const{data:s,error:c}=await k.from("grc_compliance_requirements").select(`
                *,
                standard:grc_standards(name_ar, code)
            `).order("created_at",{ascending:!1});!c&&s&&(u(s),N({total:s.length,compliant:s.filter(a=>a.compliance_status==="compliant").length,partial:s.filter(a=>a.compliance_status==="partial").length,nonCompliant:s.filter(a=>a.compliance_status==="non_compliant").length,pending:s.filter(a=>a.compliance_status==="pending").length})),d(!1)},f=s=>{const c={compliant:{icon:h,bg:"bg-green-100",text:"text-green-700",label:"ممتثل"},partial:{icon:o,bg:"bg-yellow-100",text:"text-yellow-700",label:"جزئي"},non_compliant:{icon:p,bg:"bg-red-100",text:"text-red-700",label:"غير ممتثل"},pending:{icon:o,bg:"bg-blue-100",text:"text-blue-700",label:"قيد المراجعة"},not_applicable:{icon:o,bg:"bg-gray-100",text:"text-gray-700",label:"لا ينطبق"}},{icon:a,bg:v,text:w,label:_}=c[s]||c.pending;return e.jsxs("span",{className:`flex items-center gap-1 px-3 py-1 rounded-full text-xs font-medium ${v} ${w}`,children:[e.jsx(a,{className:"w-3 h-3"}),_]})},i=l.total>0?Math.round(l.compliant/l.total*100):0,x=g.filter(s=>r==="all"||s.compliance_status===r);return e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(C,{to:"/grc",className:"flex items-center gap-2 text-gray-500 hover:text-gray-700 mb-2",children:[e.jsx(S,{className:"w-4 h-4"}),"العودة للحوكمة"]}),e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-3",style:{color:t.navy},children:[e.jsx(m,{className:"w-7 h-7",style:{color:t.teal}}),"متتبع الامتثال"]}),e.jsx("p",{className:"text-gray-500 mt-1",children:"تتبع الامتثال للمعايير واللوائح"})]}),e.jsxs("button",{className:"px-5 py-2.5 text-white rounded-xl flex items-center gap-2 shadow-lg",style:{backgroundColor:t.teal},children:[e.jsx($,{className:"w-5 h-5"}),"إضافة متطلب"]})]}),e.jsx("div",{className:"rounded-2xl p-8 text-white shadow-xl",style:{background:`linear-gradient(135deg, ${t.navy}, ${t.teal})`},children:e.jsxs("div",{className:"grid grid-cols-4 gap-8 items-center",children:[e.jsx("div",{className:"col-span-1 flex justify-center",children:e.jsxs("div",{className:"relative w-40 h-40",children:[e.jsxs("svg",{className:"w-full h-full transform -rotate-90",viewBox:"0 0 100 100",children:[e.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"rgba(255,255,255,0.2)",strokeWidth:"8"}),e.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:i>=80?t.green:i>=50?t.gold:"#ef4444",strokeWidth:"8",strokeDasharray:`${i*2.83} 283`,strokeLinecap:"round"})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsxs("span",{className:"text-4xl font-bold",children:[i,"%"]}),e.jsx("span",{className:"text-sm opacity-80",children:"الامتثال"})]})]})}),e.jsxs("div",{className:"col-span-3 grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white/10 backdrop-blur rounded-xl p-4 text-center",children:[e.jsx(L,{className:"w-8 h-8 mx-auto mb-2 opacity-80"}),e.jsx("p",{className:"text-3xl font-bold",children:l.total}),e.jsx("p",{className:"text-xs opacity-70",children:"إجمالي المتطلبات"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur rounded-xl p-4 text-center",children:[e.jsx(h,{className:"w-8 h-8 mx-auto mb-2",style:{color:t.green}}),e.jsx("p",{className:"text-3xl font-bold",children:l.compliant}),e.jsx("p",{className:"text-xs opacity-70",children:"ممتثل"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur rounded-xl p-4 text-center",children:[e.jsx(o,{className:"w-8 h-8 mx-auto mb-2",style:{color:t.gold}}),e.jsx("p",{className:"text-3xl font-bold",children:l.partial}),e.jsx("p",{className:"text-xs opacity-70",children:"جزئي"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur rounded-xl p-4 text-center",children:[e.jsx(p,{className:"w-8 h-8 mx-auto mb-2 text-red-400"}),e.jsx("p",{className:"text-3xl font-bold",children:l.nonCompliant}),e.jsx("p",{className:"text-xs opacity-70",children:"غير ممتثل"})]})]})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-4 flex items-center gap-4",children:[e.jsx(R,{className:"w-5 h-5 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-600",children:"تصفية:"}),e.jsx("div",{className:"flex gap-2",children:[{value:"all",label:"الكل"},{value:"compliant",label:"ممتثل"},{value:"partial",label:"جزئي"},{value:"non_compliant",label:"غير ممتثل"},{value:"pending",label:"قيد المراجعة"}].map(s=>e.jsx("button",{onClick:()=>b(s.value),className:`px-4 py-2 rounded-lg text-sm transition-colors ${r===s.value?"text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,style:r===s.value?{backgroundColor:t.teal}:{},children:s.label},s.value))})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden",children:j?e.jsx("div",{className:"py-12 text-center text-gray-400",children:"جاري التحميل..."}):x.length===0?e.jsxs("div",{className:"py-12 text-center text-gray-400",children:[e.jsx(m,{className:"w-16 h-16 mx-auto mb-4 opacity-30"}),e.jsx("p",{children:"لا توجد متطلبات مسجلة"})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"text-gray-600 text-sm",style:{backgroundColor:`${t.teal}10`},children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 text-right",children:"المتطلب"}),e.jsx("th",{className:"p-4 text-right",children:"المعيار"}),e.jsx("th",{className:"p-4 text-center",children:"الحالة"}),e.jsx("th",{className:"p-4 text-center",children:"الدرجة"}),e.jsx("th",{className:"p-4 text-right",children:"المسؤول"}),e.jsx("th",{className:"p-4 text-right",children:"تاريخ الاستحقاق"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:x.map(s=>{var c;return e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsxs("td",{className:"p-4",children:[e.jsx("div",{className:"font-medium",children:s.title_ar}),e.jsx("div",{className:"text-sm text-gray-500",children:s.requirement_code})]}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:"px-2 py-1 rounded text-xs",style:{backgroundColor:`${t.navy}20`,color:t.navy},children:((c=s.standard)==null?void 0:c.code)||s.section||"-"})}),e.jsx("td",{className:"p-4 text-center",children:f(s.compliance_status)}),e.jsx("td",{className:"p-4 text-center",children:e.jsxs("div",{className:"w-16 mx-auto",children:[e.jsxs("div",{className:"text-sm font-bold",children:[s.compliance_score||0,"%"]}),e.jsx("div",{className:"w-full h-1.5 bg-gray-200 rounded-full mt-1 overflow-hidden",children:e.jsx("div",{className:"h-full transition-all",style:{width:`${s.compliance_score||0}%`,backgroundColor:(s.compliance_score||0)>=80?t.green:(s.compliance_score||0)>=50?t.gold:"#ef4444"}})})]})}),e.jsx("td",{className:"p-4 text-sm",children:s.responsible_person||"-"}),e.jsx("td",{className:"p-4 text-sm text-gray-500",children:s.due_date?new Date(s.due_date).toLocaleDateString("ar-SA"):"-"})]},s.id)})})]})})]})};export{F as ComplianceTracker,F as default};
