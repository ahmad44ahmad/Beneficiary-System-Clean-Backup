import{k as N,r as i,j as e,p as w,R as C,aN as S,aS as q,a9 as k,O as L,V as R,c as I,n as p}from"./index-BOMQ6ZnB.js";import{a4 as O,a5 as P}from"./CategoricalChart-CVOu2Sdu.js";import{P as $,a as E}from"./PieChart-CJb0iZgP.js";import{C as B}from"./tooltipContext-aDNLGl9E.js";import"./PolarChart-BOiECZ66.js";const M=()=>{const h=N(),[g,c]=i.useState(!0),[a,o]=i.useState([]),[l,u]=i.useState("all"),x=[{iso_clause:"4.1",requirement_ar:"فهم المنظمة وسياقها",category:"Leadership",status:"implemented",compliance_percentage:80,priority:"high",responsible_department:"الإدارة"},{iso_clause:"4.2",requirement_ar:"فهم احتياجات الأطراف المعنية",category:"Leadership",status:"implemented",compliance_percentage:75,priority:"high",responsible_department:"الإدارة"},{iso_clause:"5.1",requirement_ar:"القيادة والالتزام",category:"Leadership",status:"in_progress",compliance_percentage:60,priority:"critical",responsible_department:"مدير المركز"},{iso_clause:"5.2",requirement_ar:"السياسة",category:"Leadership",status:"verified",compliance_percentage:90,priority:"high",responsible_department:"الجودة"},{iso_clause:"6.1",requirement_ar:"الإجراءات لمعالجة المخاطر والفرص",category:"Planning",status:"in_progress",compliance_percentage:50,priority:"critical",responsible_department:"الجودة"},{iso_clause:"7.1",requirement_ar:"الموارد",category:"Support",status:"not_started",compliance_percentage:30,priority:"high",responsible_department:"الموارد البشرية"},{iso_clause:"7.2",requirement_ar:"الكفاءة",category:"Support",status:"in_progress",compliance_percentage:45,priority:"medium",responsible_department:"التدريب"},{iso_clause:"8.1",requirement_ar:"التخطيط والتحكم التشغيلي",category:"Operation",status:"in_progress",compliance_percentage:55,priority:"high",responsible_department:"التشغيل"},{iso_clause:"8.4",requirement_ar:"خطط استمرارية الأعمال",category:"Operation",status:"not_started",compliance_percentage:20,priority:"critical",responsible_department:"الطوارئ",next_audit_date:"2026-03-01"},{iso_clause:"9.1",requirement_ar:"المراقبة والقياس والتحليل",category:"Evaluation",status:"in_progress",compliance_percentage:40,priority:"medium",responsible_department:"الجودة"},{iso_clause:"10.1",requirement_ar:"عدم المطابقة والإجراء التصحيحي",category:"Improvement",status:"not_started",compliance_percentage:15,priority:"high",responsible_department:"الجودة"}];i.useEffect(()=>{(async()=>{c(!0);const{data:r,error:v}=await k.from("iso_compliance_checklist").select("*").order("iso_clause",{ascending:!0});v||!r||r.length===0?o(x):o(r),c(!1)})()},[]);const y=s=>{switch(s){case"verified":return e.jsx(p,{className:"w-5 h-5 text-hrsd-green"});case"implemented":return e.jsx(p,{className:"w-5 h-5 text-hrsd-teal"});case"in_progress":return e.jsx(I,{className:"w-5 h-5 text-hrsd-gold"});case"non_conformity":return e.jsx(R,{className:"w-5 h-5 text-red-600"});default:return e.jsx(L,{className:"w-5 h-5 text-gray-400"})}},_=s=>{switch(s){case"verified":return"bg-hrsd-green";case"implemented":return"bg-hrsd-teal";case"in_progress":return"bg-hrsd-gold";case"non_conformity":return"bg-red-500";default:return"bg-gray-300"}},j=s=>{switch(s){case"critical":return"badge-danger";case"high":return"badge-warning";default:return"badge-info"}},d=Math.round(a.reduce((s,r)=>s+r.compliance_percentage,0)/a.length),t=a.reduce((s,r)=>(s[r.status]=(s[r.status]||0)+1,s),{}),n=[{name:"موثق",value:t.verified||0,color:"rgb(45, 180, 115)"},{name:"مطبق",value:t.implemented||0,color:"rgb(20, 130, 135)"},{name:"قيد التنفيذ",value:t.in_progress||0,color:"rgb(250, 180, 20)"},{name:"لم يبدأ",value:t.not_started||0,color:"rgb(209, 213, 219)"},{name:"عدم مطابقة",value:t.non_conformity||0,color:"rgb(239, 68, 68)"}].filter(s=>s.value>0),b=["all",...new Set(a.map(s=>s.category))],f=l==="all"?a:a.filter(s=>s.category===l),m=a.filter(s=>s.priority==="critical"&&s.status!=="verified");return e.jsxs("div",{className:"min-h-screen bg-gray-50 p-6",dir:"rtl",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("button",{onClick:()=>h(-1),className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(w,{className:"w-5 h-5"})}),e.jsx("div",{className:"p-3 bg-gradient-to-br from-hrsd-navy to-hrsd-teal rounded-xl",children:e.jsx(C,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-hierarchy-title text-gray-900",children:"مؤشر الامتثال ISO 22301"}),e.jsx("p",{className:"text-hierarchy-small text-gray-500",children:"قياس التوافق مع متطلبات استمرارية الأعمال"})]}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mr-auto p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(S,{className:"w-5 h-5 text-gray-500"})})]})}),g?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-hrsd-teal"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-hrsd-teal to-hrsd-navy rounded-2xl p-6 text-white",children:[e.jsx(q,{className:"w-8 h-8 mb-2"}),e.jsxs("p",{className:"text-5xl font-bold",children:[d,"%"]}),e.jsx("p",{className:"text-sm text-white/80",children:"نسبة الامتثال الإجمالية"}),e.jsx("div",{className:"mt-4 bg-white/20 rounded-full h-3",children:e.jsx("div",{className:"bg-white rounded-full h-3 transition-all",style:{width:`${d}%`}})})]}),e.jsxs("div",{className:"hrsd-card",children:[e.jsx("h4",{className:"text-hierarchy-small text-gray-500 mb-3",children:"توزيع الحالات"}),e.jsx(O,{width:"100%",height:150,children:e.jsxs($,{children:[e.jsx(E,{data:n,cx:"50%",cy:"50%",innerRadius:40,outerRadius:60,dataKey:"value",children:n.map((s,r)=>e.jsx(B,{fill:s.color},`cell-${r}`))}),e.jsx(P,{})]})}),e.jsx("div",{className:"flex flex-wrap justify-center gap-2 text-xs",children:n.map((s,r)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:s.color}}),e.jsxs("span",{children:[s.name," (",s.value,")"]})]},r))})]}),e.jsxs("div",{className:"hrsd-card",children:[e.jsx("h4",{className:"text-hierarchy-small text-gray-500 mb-3",children:"⚠️ بنود حرجة تحتاج انتباه"}),m.length>0?e.jsx("div",{className:"space-y-2",children:m.slice(0,3).map((s,r)=>e.jsxs("div",{className:"p-2 bg-red-50 rounded-lg text-sm",children:[e.jsx("span",{className:"font-bold",children:s.iso_clause}),": ",s.requirement_ar]},r))}):e.jsx("p",{className:"text-center text-gray-400 py-4",children:"لا توجد بنود حرجة"})]})]}),e.jsx("div",{className:"mb-4 flex gap-2 flex-wrap",children:b.map(s=>e.jsx("button",{onClick:()=>u(s),className:`px-4 py-2 rounded-lg text-sm transition-colors ${l===s?"bg-hrsd-teal text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:s==="all"?"الكل":s},s))}),e.jsx("div",{className:"hrsd-card",children:e.jsx("div",{className:"space-y-3",children:f.map((s,r)=>e.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[y(s.status),e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold",children:["البند ",s.iso_clause]}),e.jsx("p",{className:"text-sm text-gray-600",children:s.requirement_ar})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:j(s.priority),children:s.priority==="critical"?"حرج":s.priority==="high"?"عالي":"متوسط"})})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-3",children:[e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${_(s.status)}`,style:{width:`${s.compliance_percentage}%`}})}),e.jsxs("span",{className:"text-sm font-medium min-w-[50px]",children:[s.compliance_percentage,"%"]}),e.jsx("span",{className:"text-xs text-gray-500",children:s.responsible_department})]})]},r))})})]})]})};export{M as ISOComplianceTracker,M as default};
