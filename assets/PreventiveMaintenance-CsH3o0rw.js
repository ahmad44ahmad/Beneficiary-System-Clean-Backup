import{r as d,a9 as D,j as e,L as M,a3 as S,b as u,P as C,o as F,p as Y,a7 as $,T,c as L}from"./index-BOMQ6ZnB.js";const q=()=>{const[n,j]=d.useState([]),[N,o]=d.useState(!0),[s,m]=d.useState(new Date),[i,g]=d.useState("list");d.useEffect(()=>{b()},[s]);const b=async()=>{o(!0);const t=new Date(s.getFullYear(),s.getMonth(),1).toISOString().split("T")[0],a=new Date(s.getFullYear(),s.getMonth()+1,0).toISOString().split("T")[0],{data:r,error:x}=await D.from("om_preventive_schedules").select(`
                *,
                asset:om_assets(name_ar, asset_code)
            `).gte("next_due_date",t).lte("next_due_date",a).order("next_due_date",{ascending:!0});x||j(r||[]),o(!1)},y={daily:"يومي",weekly:"أسبوعي",monthly:"شهري",quarterly:"ربع سنوي",semi_annual:"نصف سنوي",annual:"سنوي"},w=()=>{const t=s.getFullYear(),a=s.getMonth(),r=new Date(t,a+1,0).getDate(),x=new Date(t,a,1).getDay(),h=[];for(let l=0;l<x;l++)h.push(null);for(let l=1;l<=r;l++)h.push(l);return h},f=t=>{const a=`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-${String(t).padStart(2,"0")}`;return n.filter(r=>r.next_due_date===a)},c=t=>new Date(t)<new Date,p=t=>{const a=new Date;return a.getFullYear()===s.getFullYear()&&a.getMonth()===s.getMonth()&&a.getDate()===t},v=["يناير","فبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"],_=["أحد","اثنين","ثلاثاء","أربعاء","خميس","جمعة","سبت"];return e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(M,{to:"/operations",className:"flex items-center gap-2 text-gray-500 hover:text-gray-700 mb-2",children:[e.jsx(S,{className:"w-4 h-4"}),"العودة للتشغيل والصيانة"]}),e.jsxs("h1",{className:"text-2xl font-bold text-hrsd-primary flex items-center gap-3",children:[e.jsx(u,{className:"w-7 h-7"}),"الصيانة الوقائية"]}),e.jsx("p",{className:"text-gray-500 mt-1",children:"جدول المهام المجدولة والصيانة الدورية"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>g("list"),className:`px-4 py-2 rounded-lg text-sm ${i==="list"?"bg-white shadow":""}`,children:"قائمة"}),e.jsx("button",{onClick:()=>g("calendar"),className:`px-4 py-2 rounded-lg text-sm ${i==="calendar"?"bg-white shadow":""}`,children:"تقويم"})]}),e.jsxs("button",{className:"px-4 py-2 bg-hrsd-primary text-white rounded-lg hover:bg-hrsd-primary/90 flex items-center gap-2 shadow-lg",children:[e.jsx(C,{className:"w-5 h-5"}),"إضافة مهمة"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-4 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>m(new Date(s.getFullYear(),s.getMonth()-1)),className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(F,{className:"w-5 h-5"})}),e.jsxs("h2",{className:"text-xl font-bold",children:[v[s.getMonth()]," ",s.getFullYear()]}),e.jsx("button",{onClick:()=>m(new Date(s.getFullYear(),s.getMonth()+1)),className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(Y,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:n.length}),e.jsx("p",{className:"text-sm text-gray-500",children:"مهام هذا الشهر"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:n.filter(t=>t.status==="completed").length}),e.jsx("p",{className:"text-sm text-gray-500",children:"مكتملة"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-amber-600",children:n.filter(t=>t.status==="active"&&!c(t.next_due_date)).length}),e.jsx("p",{className:"text-sm text-gray-500",children:"قادمة"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-red-600",children:n.filter(t=>c(t.next_due_date)&&t.status==="active").length}),e.jsx("p",{className:"text-sm text-gray-500",children:"متأخرة"})]})]}),i==="calendar"&&e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6",children:[e.jsx("div",{className:"grid grid-cols-7 gap-2 mb-2",children:_.map(t=>e.jsx("div",{className:"text-center text-sm font-medium text-gray-500 py-2",children:t},t))}),e.jsx("div",{className:"grid grid-cols-7 gap-2",children:w().map((t,a)=>e.jsx("div",{className:`min-h-[80px] p-2 rounded-lg border ${t===null?"bg-gray-50 border-transparent":p(t)?"bg-blue-50 border-blue-300":"bg-white border-gray-100 hover:border-hrsd-primary/30"}`,children:t&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:`text-sm font-medium ${p(t)?"text-blue-600":"text-gray-700"}`,children:t}),e.jsx("div",{className:"mt-1 space-y-1",children:f(t).map(r=>e.jsx("div",{className:`text-xs px-2 py-1 rounded truncate ${r.status==="completed"?"bg-green-100 text-green-800":c(r.next_due_date)?"bg-red-100 text-red-800":"bg-amber-100 text-amber-800"}`,title:r.task_name,children:r.task_name},r.id))})]})},a))})]}),i==="list"&&e.jsx("div",{className:"bg-white rounded-xl shadow-md overflow-hidden",children:N?e.jsx("div",{className:"p-8 text-center text-gray-400",children:"جاري التحميل..."}):n.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-400",children:[e.jsx(u,{className:"w-16 h-16 mx-auto mb-4 opacity-30"}),e.jsx("p",{children:"لا توجد مهام صيانة وقائية لهذا الشهر"})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 text-sm",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 text-right",children:"المهمة"}),e.jsx("th",{className:"p-4 text-right",children:"الأصل"}),e.jsx("th",{className:"p-4 text-center",children:"التكرار"}),e.jsx("th",{className:"p-4 text-center",children:"تاريخ الاستحقاق"}),e.jsx("th",{className:"p-4 text-center",children:"الحالة"}),e.jsx("th",{className:"p-4 text-center",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:n.map(t=>{var a,r;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"p-4",children:[e.jsx("div",{className:"font-medium",children:t.task_name}),e.jsx("div",{className:"text-sm text-gray-500",children:t.task_description})]}),e.jsxs("td",{className:"p-4",children:[((a=t.asset)==null?void 0:a.name_ar)||"-",e.jsx("div",{className:"text-xs text-gray-400",children:(r=t.asset)==null?void 0:r.asset_code})]}),e.jsx("td",{className:"p-4 text-center",children:e.jsx("span",{className:"px-2 py-1 bg-gray-100 rounded text-sm",children:y[t.frequency]||t.frequency})}),e.jsx("td",{className:"p-4 text-center",children:e.jsx("span",{className:`${c(t.next_due_date)&&t.status==="active"?"text-red-600 font-medium":""}`,children:new Date(t.next_due_date).toLocaleDateString("ar-SA")})}),e.jsx("td",{className:"p-4 text-center",children:t.status==="completed"?e.jsxs("span",{className:"flex items-center justify-center gap-1 text-green-600",children:[e.jsx($,{className:"w-4 h-4"})," مكتمل"]}):c(t.next_due_date)?e.jsxs("span",{className:"flex items-center justify-center gap-1 text-red-600",children:[e.jsx(T,{className:"w-4 h-4"})," متأخر"]}):e.jsxs("span",{className:"flex items-center justify-center gap-1 text-amber-600",children:[e.jsx(L,{className:"w-4 h-4"})," قادم"]})}),e.jsx("td",{className:"p-4 text-center",children:e.jsx("button",{className:"px-3 py-1 bg-green-500 text-white rounded text-sm hover:bg-green-600",children:"تم التنفيذ"})})]},t.id)})})]})})]})};export{q as PreventiveMaintenance,q as default};
