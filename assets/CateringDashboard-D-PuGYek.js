import{r as c,a9 as h,k as M,j as e,ab as g,F as A,T as _,a7 as R,aw as F,a0 as C}from"./index-BOMQ6ZnB.js";const j=[{id:"1",beneficiary_name:"أحمد محمد علي",meal_type:"غداء",status:"consumed",consumption:85,time:"12:30"},{id:"2",beneficiary_name:"فاطمة عبدالله",meal_type:"غداء",status:"consumed",consumption:100,time:"12:35"},{id:"3",beneficiary_name:"محمد سعيد",meal_type:"غداء",status:"delivered",consumption:0,time:"12:40"},{id:"4",beneficiary_name:"نورة أحمد",meal_type:"غداء",status:"pending",consumption:0,time:"12:45"},{id:"5",beneficiary_name:"خالد العمري",meal_type:"غداء",status:"refused",consumption:0,time:"12:50"}],p={totalMealsServed:127,specialDietsCount:12,satisfactionRate:89,wasteRate:11},L=()=>{const[d,l]=c.useState(!0),[o,a]=c.useState(p),[s,i]=c.useState([]),[D,x]=c.useState(!1);c.useEffect(()=>{var m;b();const n=(m=h)==null?void 0:m.channel("catering_dashboard").on("postgres_changes",{event:"*",schema:"public",table:"daily_meals"},()=>{b()}).subscribe();return()=>{n==null||n.unsubscribe()}},[]);const b=async()=>{try{if(l(!0),!h){a(p),i(j),x(!0);return}const{count:n,error:m}=await h.from("dietary_plans").select("*",{count:"exact",head:!0}).neq("plan_type","قياسي"),{data:r,error:S}=await h.from("daily_meals").select(`
                    id, 
                    meal_type, 
                    status, 
                    consumption_percentage, 
                    updated_at,
                    beneficiaries ( full_name )
                `).eq("meal_date",new Date().toISOString().split("T")[0]);if(m||S||!(r!=null&&r.length)){a(p),i(j),x(!0);return}const f=(r==null?void 0:r.filter(t=>t.status==="delivered"||t.status==="consumed"))||[],N=f.length,v=f.reduce((t,u)=>t+(u.consumption_percentage||0),0)/(N||1);a({totalMealsServed:N,specialDietsCount:n||0,satisfactionRate:Math.round(v),wasteRate:Math.round(100-v)});const E=(r==null?void 0:r.map(t=>{var u,w;return{id:t.id,beneficiary_name:Array.isArray(t.beneficiaries)?(u=t.beneficiaries[0])==null?void 0:u.full_name:((w=t.beneficiaries)==null?void 0:w.full_name)||"غير معروف",meal_type:t.meal_type,status:t.status,consumption:t.consumption_percentage||0,time:new Date(t.updated_at).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})}}))||[];i(E),x(!1)}catch{a(p),i(j),x(!0)}finally{l(!1)}};return{loading:d,kpis:o,todaysMeals:s,usingDemoData:D,refresh:b}},y={primary:"#F5961E",success:"#2DB473",teal:"#148287",navy:"#14415A"},O=()=>{const{loading:d,kpis:l,todaysMeals:o}=L(),a=M();return e.jsxs("div",{className:"p-6 space-y-6 bg-gray-50 min-h-screen",dir:"rtl",children:[e.jsxs("header",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-[#14415A]",children:"لوحة قيادة الإعاشة والتغذية"}),e.jsx("p",{className:"text-gray-600",children:"نظام إدارة الوجبات والمخزون الغذائي"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>a("/catering/daily-log"),className:"px-4 py-2 bg-[#F5961E] text-white rounded-lg hover:bg-[#d98210] transition-colors font-medium flex items-center gap-2",children:[e.jsx(g,{className:"w-5 h-5"}),"تسجيل وجبات اليوم"]}),e.jsxs("button",{onClick:()=>a("/catering/reports"),className:"px-4 py-2 bg-[#14415A] text-white rounded-lg hover:bg-[#0f3246] transition-colors font-medium flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5"}),"الجداول والتقارير"]}),e.jsx("div",{className:"h-8 w-px bg-gray-300 mx-1"}),e.jsxs("button",{onClick:()=>a("/catering/quality"),className:"px-4 py-2 bg-white border border-red-200 text-red-600 rounded-lg hover:bg-red-50 transition-colors font-medium flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5"}),"مراقبة الجودة"]}),e.jsxs("button",{onClick:()=>a("/catering/quality-dashboard"),className:"px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium flex items-center gap-2",children:[e.jsx(g,{className:"w-5 h-5"}),"لوحة القيادة"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[{label:"الوجبات المقدمة اليوم",value:l.totalMealsServed,color:y.teal,icon:g},{label:"خطط غذائية خاصة",value:l.specialDietsCount,color:y.primary,icon:_},{label:"نسبة الاستهلاك (الرضا)",value:`${l.satisfactionRate}%`,color:y.success,icon:R},{label:"نسبة الهدر",value:`${l.wasteRate}%`,color:y.navy,icon:F}].map((s,i)=>e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-sm border-t-4",style:{borderColor:s.color},children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:s.label}),e.jsx("h3",{className:"text-3xl font-bold",style:{color:s.color},children:d?e.jsx(C,{className:"w-6 h-6 animate-spin"}):s.value})]}),e.jsx("div",{className:"p-3 rounded-lg bg-gray-50",children:e.jsx(s.icon,{className:"w-6 h-6",style:{color:s.color}})})]})},i))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-white rounded-xl shadow-sm p-6",children:[e.jsx("h2",{className:"text-lg font-bold text-[#14415A] mb-4",children:"سجل الوجبات الأخير"}),d?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(C,{className:"w-8 h-8 animate-spin text-gray-400"})}):o.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-right",children:[e.jsx("thead",{className:"text-xs text-gray-500 bg-gray-50 uppercase",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"المستفيد"}),e.jsx("th",{className:"px-4 py-3",children:"الوجبة"}),e.jsx("th",{className:"px-4 py-3",children:"الحالة"}),e.jsx("th",{className:"px-4 py-3",children:"الاستهلاك"}),e.jsx("th",{className:"px-4 py-3",children:"الوقت"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:o.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 font-medium text-gray-900",children:s.beneficiary_name}),e.jsx("td",{className:"px-4 py-3",children:s.meal_type}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${s.status==="consumed"?"bg-green-100 text-green-800":s.status==="refused"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:s.status==="consumed"?"تــــم":s.status==="refused"?"رفـــض":"معلــق"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:e.jsx("div",{className:"bg-[#148287] h-2.5 rounded-full",style:{width:`${s.consumption}%`}})})}),e.jsx("td",{className:"px-4 py-3 text-gray-500 text-sm",children:s.time})]},s.id))})]})}):e.jsxs("div",{className:"border border-dashed border-gray-300 rounded-lg h-64 flex flex-col items-center justify-center text-gray-400",children:[e.jsx(g,{className:"w-12 h-12 mb-2 opacity-20"}),e.jsx("p",{children:"لا توجد وجبات مسجلة لليوم بعد"}),e.jsx("button",{onClick:()=>a("/catering/daily-log"),className:"mt-4 text-[#F5961E] hover:underline text-sm",children:"ابدأ التسجيل الآن"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[e.jsx("h2",{className:"text-lg font-bold text-[#14415A] mb-4",children:"تنبيهات المخاطر"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-red-50 text-red-700 rounded-lg text-sm border-r-4 border-red-500",children:[e.jsx("strong",{children:"نقص في المخزون:"})," مياه شرب (عبوات)"]}),e.jsxs("div",{className:"p-4 bg-yellow-50 text-yellow-700 rounded-lg text-sm border-r-4 border-yellow-500",children:[e.jsx("strong",{children:"تذكير:"})," تحديث بيانات الحساسية للمستفيدين الجدد"]}),e.jsxs("div",{className:"p-4 bg-blue-50 text-blue-700 rounded-lg text-sm border-r-4 border-blue-500",children:[e.jsx("strong",{children:"قائمة الغد:"})," تم اعتماد القائمة (أرز كبسة + دجاج)"]})]})]})]})]})};export{O as CateringDashboard};
