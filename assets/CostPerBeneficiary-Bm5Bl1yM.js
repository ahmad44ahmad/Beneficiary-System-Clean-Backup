import{k as _,r as i,j as e,p as v,aC as m,aN as w,a as C,aV as D,a9 as S,ah as k,ae as L,Z as M,ab as O,U as P}from"./index-BOMQ6ZnB.js";import{a4 as x,a5 as g}from"./CategoricalChart-CVOu2Sdu.js";import{B,a as R}from"./BarChart-CapdVOWV.js";import{C as $}from"./CartesianGrid-Dh6FfMw5.js";import{X as U,Y as A}from"./CartesianChart-BCPM_Iof.js";import{P as E,a as F}from"./PieChart-CJb0iZgP.js";import{C as K}from"./tooltipContext-aDNLGl9E.js";import"./ErrorBarContext-DeCBPfcE.js";import"./graphicalItemSelectors-D0O9Wiuq.js";import"./PolarChart-BOiECZ66.js";const H=()=>{const y=_(),[u,l]=i.useState(!0),[b,h]=i.useState([]),j=[{cost_month:"2025-10-01",cost_category:"رواتب",amount:45e4,beneficiary_count:120},{cost_month:"2025-10-01",cost_category:"غذاء",amount:85e3,beneficiary_count:120},{cost_month:"2025-10-01",cost_category:"كهرباء",amount:35e3,beneficiary_count:120},{cost_month:"2025-10-01",cost_category:"مياه",amount:8e3,beneficiary_count:120},{cost_month:"2025-10-01",cost_category:"صيانة",amount:25e3,beneficiary_count:120},{cost_month:"2025-11-01",cost_category:"رواتب",amount:45e4,beneficiary_count:118},{cost_month:"2025-11-01",cost_category:"غذاء",amount:82e3,beneficiary_count:118},{cost_month:"2025-11-01",cost_category:"كهرباء",amount:38e3,beneficiary_count:118},{cost_month:"2025-11-01",cost_category:"مياه",amount:7500,beneficiary_count:118},{cost_month:"2025-11-01",cost_category:"صيانة",amount:42e3,beneficiary_count:118},{cost_month:"2025-12-01",cost_category:"رواتب",amount:455e3,beneficiary_count:122},{cost_month:"2025-12-01",cost_category:"غذاء",amount:88e3,beneficiary_count:122},{cost_month:"2025-12-01",cost_category:"كهرباء",amount:32e3,beneficiary_count:122},{cost_month:"2025-12-01",cost_category:"مياه",amount:8500,beneficiary_count:122},{cost_month:"2025-12-01",cost_category:"صيانة",amount:18e3,beneficiary_count:122}];i.useEffect(()=>{(async()=>{l(!0);const{data:t,error:a}=await S.from("cost_tracking").select("*").order("cost_month",{ascending:!0});a||!t||t.length===0?h(j):h(t),l(!1)})()},[]);const o=b.reduce((s,t)=>{const a=t.cost_month;return s[a]||(s[a]={total:0,beneficiaries:t.beneficiary_count,categories:{}}),s[a].total+=t.amount,s[a].categories[t.cost_category]=t.amount,s},{}),f=Object.keys(o).sort().pop()||"",r=o[f]||{total:0,beneficiaries:1,categories:{}},n=r.total/r.beneficiaries/30,p=Object.entries(o).map(([s,t])=>({month:new Date(s).toLocaleDateString("ar-SA",{month:"short"}),total:Math.round(t.total/t.beneficiaries/30),beneficiaries:t.beneficiaries})),d=Object.entries(r.categories).map(([s,t])=>({name:s,value:t})),c=["rgb(20, 130, 135)","rgb(245, 150, 30)","rgb(45, 180, 115)","rgb(20, 65, 90)","rgb(250, 180, 20)"],N={رواتب:e.jsx(P,{className:"w-5 h-5"}),غذاء:e.jsx(O,{className:"w-5 h-5"}),كهرباء:e.jsx(M,{className:"w-5 h-5"}),مياه:e.jsx(L,{className:"w-5 h-5"}),صيانة:e.jsx(k,{className:"w-5 h-5"})};return e.jsxs("div",{className:"min-h-screen bg-gray-50 p-6",dir:"rtl",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("button",{onClick:()=>y(-1),className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(v,{className:"w-5 h-5"})}),e.jsx("div",{className:"p-3 bg-gradient-to-br from-hrsd-gold to-hrsd-orange rounded-xl",children:e.jsx(m,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-hierarchy-title text-gray-900",children:"مؤشر التكلفة/المستفيد"}),e.jsx("p",{className:"text-hierarchy-small text-gray-500",children:"تحليل التكاليف وجاهزية الخصخصة"})]}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mr-auto p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(w,{className:"w-5 h-5 text-gray-500"})})]})}),u?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-hrsd-teal"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-hrsd-teal to-hrsd-navy rounded-2xl p-6 text-white col-span-1 md:col-span-2",children:[e.jsx("p",{className:"text-white/80 text-sm mb-2",children:"تكلفة المستفيد اليومية"}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("span",{className:"text-5xl font-bold",children:Math.round(n)}),e.jsx("span",{className:"text-2xl mb-1",children:"ريال/يوم"})]}),e.jsxs("p",{className:"text-sm mt-4 text-white/80",children:["إجمالي شهري: ",r.total.toLocaleString()," ريال"]}),e.jsxs("p",{className:"text-sm text-white/80",children:["عدد المستفيدين: ",r.beneficiaries]})]}),e.jsxs("div",{className:"hrsd-card",children:[e.jsx("p",{className:"text-hierarchy-small text-gray-500 mb-2",children:"تكلفة سنوية متوقعة"}),e.jsx("p",{className:"text-3xl font-bold text-hrsd-navy",children:Math.round(n*365*r.beneficiaries/1e6).toFixed(1)}),e.jsx("p",{className:"text-sm text-gray-500",children:"مليون ريال"})]}),e.jsxs("div",{className:"hrsd-card",children:[e.jsx("p",{className:"text-hierarchy-small text-gray-500 mb-2",children:"سعر الخصخصة المقترح"}),e.jsx("p",{className:"text-3xl font-bold text-hrsd-gold",children:Math.round(n*1.15)}),e.jsx("p",{className:"text-sm text-gray-500",children:"ريال/مستفيد/يوم (+15%)"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"hrsd-card",children:[e.jsxs("h3",{className:"text-hierarchy-subheading text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5 text-hrsd-teal"}),"اتجاه التكلفة اليومية"]}),e.jsx(x,{width:"100%",height:250,children:e.jsxs(B,{data:p,children:[e.jsx($,{strokeDasharray:"3 3"}),e.jsx(U,{dataKey:"month"}),e.jsx(A,{}),e.jsx(g,{formatter:s=>[`${s} ريال`,"تكلفة/مستفيد/يوم"]}),e.jsx(R,{dataKey:"total",fill:"rgb(20, 130, 135)",radius:[4,4,0,0]})]})})]}),e.jsxs("div",{className:"hrsd-card",children:[e.jsxs("h3",{className:"text-hierarchy-subheading text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5 text-hrsd-gold"}),"توزيع التكاليف"]}),e.jsx(x,{width:"100%",height:250,children:e.jsxs(E,{children:[e.jsx(F,{data:d,cx:"50%",cy:"50%",outerRadius:80,dataKey:"value",label:({name:s,percent:t})=>`${s} ${(t*100).toFixed(0)}%`,children:d.map((s,t)=>e.jsx(K,{fill:c[t%c.length]},`cell-${t}`))}),e.jsx(g,{formatter:s=>`${s.toLocaleString()} ريال`})]})})]})]}),e.jsxs("div",{className:"hrsd-card",children:[e.jsx("h3",{className:"text-hierarchy-subheading text-gray-800 mb-4",children:"تفصيل التكاليف حسب الفئة"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:Object.entries(r.categories).map(([s,t],a)=>e.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl text-center",children:[e.jsx("div",{className:"w-10 h-10 mx-auto mb-2 rounded-full flex items-center justify-center",style:{backgroundColor:c[a%c.length]+"20",color:c[a%c.length]},children:N[s]||e.jsx(m,{className:"w-5 h-5"})}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:t.toLocaleString()}),e.jsx("p",{className:"text-hierarchy-small text-gray-500",children:s}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[Math.round(t/r.beneficiaries/30)," ريال/مستفيد/يوم"]})]},a))})]})]})]})};export{H as CostPerBeneficiary,H as default};
