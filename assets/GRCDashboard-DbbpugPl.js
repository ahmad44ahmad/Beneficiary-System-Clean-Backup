import{r as j,j as e,D as o,R as O,E as L,aN as G,aO as C,n as k,F as R,aP as y,aQ as B,aR as H,T as $,aA as E,K as A,aS as M,t as U,U as P,aT as V,aU as W,aV as K,b as I,a1 as Z,Z as D,N as z,w as T,c as Y,V as Q,ae as X,d as J}from"./index-BOMQ6ZnB.js";const _={clinical:{label:"سريري",labelEn:"Clinical",color:"text-rose-400",bg:"bg-rose-500/20",gradient:"from-rose-500 to-pink-600",icon:W},safety:{label:"سلامة",labelEn:"Safety",color:"text-red-400",bg:"bg-red-500/20",gradient:"from-red-500 to-orange-600",icon:V},social:{label:"اجتماعي",labelEn:"Social",color:"text-violet-400",bg:"bg-violet-500/20",gradient:"from-violet-500 to-purple-600",icon:P},infrastructure:{label:"بنية تحتية",labelEn:"Infrastructure",color:"text-amber-400",bg:"bg-amber-500/20",gradient:"from-amber-500 to-yellow-600",icon:U},compliance:{label:"امتثال",labelEn:"Compliance",color:"text-blue-400",bg:"bg-blue-500/20",gradient:"from-blue-500 to-cyan-600",icon:E},contractual:{label:"تعاقدي",labelEn:"Contractual",color:"text-emerald-400",bg:"bg-emerald-500/20",gradient:"from-emerald-500 to-teal-600",icon:M}},q={open:{label:"مفتوح",color:"text-red-400",bg:"bg-red-500/20",icon:C},mitigating:{label:"قيد المعالجة",color:"text-amber-400",bg:"bg-amber-500/20",icon:D},monitoring:{label:"تحت المراقبة",color:"text-blue-400",bg:"bg-blue-500/20",icon:Z},closed:{label:"مغلق",color:"text-emerald-400",bg:"bg-emerald-500/20",icon:k}},ee={critical:{label:"حرج",color:"text-red-400",bg:"bg-red-500/20"},major:{label:"رئيسي",color:"text-amber-400",bg:"bg-amber-500/20"},minor:{label:"ثانوي",color:"text-blue-400",bg:"bg-blue-500/20"}},b=[{id:"clin-01",code:"CLIN-01",title:"الأخطاء الدوائية",description:"صرف دواء خاطئ أو جرعة خاطئة نتيجة التشابه في الأسماء أو العبوات، أو الاعتماد على الذاكرة",category:"clinical",likelihood:3,impact:5,riskScore:15,status:"mitigating",owner:"د. محمد بلال",mitigationPlan:"تطبيق نظام الحقوق الخمسة (5 Rights) بصرامة + التحقق المزدوج للأدوية عالية الخطورة + التحول الرقمي الكامل",controls:["نظام التحقق المزدوج","الحقوق الخمسة","نظام الوصفات الإلكتروني","تدقيق عربة الطوارئ"],isoRef:"ISO 9001 (8.5.1)"},{id:"clin-02",code:"CLIN-02",title:"قرح الفراش",description:"فشل الالتزام بجدول التقليب الدوري للمستفيدين طريحي الفراش مما يؤدي لتلف الأنسجة والتهابات خطيرة",category:"clinical",likelihood:4,impact:4,riskScore:16,status:"mitigating",owner:"نايف الغامدي",mitigationPlan:"استخدام ساعة التقليب المرئية + توفير مراتب هوائية ديناميكية + تقييم الجلد يومياً بمقياس Braden",controls:["ساعة التقليب","مراتب هوائية","مقياس Braden","نموذج متابعة التقليب"],isoRef:"بروتوكول العناية التمريضية"},{id:"clin-03",code:"CLIN-03",title:"تفشي العدوى المكتسبة",description:"انتقال عدوى تنفسية أو تلامسية نتيجة ضعف تعقيم الأيدي أو عدم عزل الحالات المشتبهة",category:"clinical",likelihood:3,impact:5,riskScore:15,status:"monitoring",owner:"نايف الغامدي",mitigationPlan:"فرض سياسة اللحظات الخمس لنظافة الأيدي + مسحات بيئية دورية + سياسات العزل الفوري",controls:["اللحظات الخمس","المسحات البيئية","سياسات العزل","إدارة النفايات الطبية"],isoRef:"دليل مكافحة العدوى الوزاري"},{id:"clin-04",code:"CLIN-04",title:"الاختناق أثناء التغذية",description:"تقديم قوام طعام غير مناسب لمستفيدين يعانون من صعوبات البلع (Dysphagia)",category:"clinical",likelihood:2,impact:5,riskScore:10,status:"monitoring",owner:"أخصائي التغذية",mitigationPlan:"تقييم قدرة البلع من أخصائي النطق + علامات واضحة على سرير المريض + تدريب على مناورة هايملاخ",controls:["تقييم البلع","Color Coding","تدريب هايملاخ","معايير سلامة الغذاء"],isoRef:"معايير سلامة الغذاء"},{id:"soc-01",code:"SOC-01",title:"انتهاك الخصوصية",description:"تصوير المستفيدين في أوضاع غير لائقة عبر كاميرات المراقبة أو الهواتف الشخصية للموظفين",category:"social",likelihood:2,impact:5,riskScore:10,status:"mitigating",owner:"مدير المركز",mitigationPlan:"الحظر التام للكاميرات في غرف النوم ودورات المياه + منع الهواتف في المناطق الخاصة + تعهدات قانونية",controls:["حظر الكاميرات","منع الهواتف","التعهدات القانونية","الإشراف البشري"],isoRef:"نظام الحماية من الإيذاء / ISO 27001"},{id:"soc-02",code:"SOC-02",title:"العنف والإيذاء",description:"تعرض المستفيد لعنف جسدي أو لفظي من قبل الموظفين نتيجة الاحتراق الوظيفي أو ضعف التدريب",category:"social",likelihood:2,impact:5,riskScore:10,status:"monitoring",owner:"رئيس الاجتماعية",mitigationPlan:"تطبيق سياسة عدم التسامح + التدوير الوظيفي + قنوات إبلاغ سرية + تدريب إدارة السلوك العدواني",controls:["سياسة Zero Tolerance","التدوير الوظيفي","قنوات الإبلاغ السرية","تدريب إدارة السلوك"],isoRef:"اللوائح التنفيذية للوزارة"},{id:"soc-03",code:"SOC-03",title:"فشل الدمج والعزل",description:"بقاء المستفيدين داخل المركز دون برامج دمج حقيقية مما يحول المركز إلى مؤسسة إيوائية",category:"social",likelihood:4,impact:3,riskScore:12,status:"mitigating",owner:"رئيس الاجتماعية",mitigationPlan:"ربط KPIs بنسبة المدمجين + تفعيل الشراكات المجتمعية + مراجعة ISP ربع سنوياً",controls:["مؤشرات الدمج","الشراكات المجتمعية","مراجعة ISP","برامج التوظيف"],isoRef:"الاستراتيجية الوطنية للإعاقة"},{id:"saf-01",code:"SAF-01",title:"الحريق في المباني القديمة",description:"غياب مرشات المياه التلقائية (Sprinklers) وسرعة انتشار الدخان في المباني القديمة",category:"safety",likelihood:3,impact:5,riskScore:15,status:"open",owner:"سعد بخيت الزهراني",mitigationPlan:"تطبيق نظام Fire Watch البشري 24 ساعة + زيادة الطفايات + كواشف VESDA + أبواب الحريق",controls:["Fire Watch","طفايات يدوية","كواشف VESDA","أبواب الحريق"],isoRef:"كود البناء السعودي (SBC 801)",dueDate:"30 مارس 2026"},{id:"saf-02",code:"SAF-02",title:"صعوبة الإخلاء الطارئ",description:"صعوبة إخلاء المستفيدين غير القادرين على الحركة في الوقت القياسي (5 دقائق)",category:"safety",likelihood:3,impact:5,riskScore:15,status:"mitigating",owner:"سعد بخيت الزهراني",mitigationPlan:"إعداد خطط إخلاء شخصية (PEEPs) لكل مستفيد + كراسي الإخلاء + تجارب إخلاء دورية",controls:["PEEPs","كراسي الإخلاء","ملاءات انزلاقية","تجارب الإخلاء"],isoRef:"ISO 45001 / مبادرة أمان مستدام"},{id:"saf-03",code:"SAF-03",title:"حوادث السقوط والانزلاق",description:"أرضيات غير آمنة أو عدم وجود مقابض دعم كافية في دورات المياه",category:"infrastructure",likelihood:4,impact:3,riskScore:12,status:"monitoring",owner:"فواز عطية العمري",mitigationPlan:"تطبيق كود الوصول الشامل + صيانة فورية للتسربات + أحذية مانعة للانزلاق",controls:["كود الوصول الشامل","أرضيات مانعة للانزلاق","مقابض الدعم","صيانة فورية"],isoRef:"معايير الوصول الشامل"},{id:"con-01",code:"CON-01",title:"تقصير مقاول الصيانة والنظافة",description:"نقص العمالة أو تدني مستوى النظافة أو تأخر إصلاح الأعطال الحرجة",category:"contractual",likelihood:3,impact:3,riskScore:9,status:"monitoring",owner:"مدير المشتريات",mitigationPlan:"تفعيل جولات التفتيش اليومية + ربط المستخلصات بتقارير الأداء + نظام البلاغات الإلكتروني",controls:["جولات التفتيش","تقارير الأداء","نظام البلاغات","غرامات التقصير"],isoRef:"كراسة الشروط والمواصفات"},{id:"con-02",code:"CON-02",title:"مخاطر عقد التغذية",description:"نقص كميات الطعام أو عدم الالتزام بالمواصفات أو التسمم الغذائي",category:"contractual",likelihood:2,impact:4,riskScore:8,status:"monitoring",owner:"لجنة الإعاشة",mitigationPlan:"تشكيل لجنة استلام يومية + فحص ظاهري ومخبري + مراقبة درجات الحرارة",controls:["لجنة الاستلام","الفحص المخبري","مراقبة الحرارة","نظام الغرامات"],isoRef:"عقد شركة الهناء"}],u=[{id:"ncr-001",code:"NCR-001",title:"فشل البنية التحتية للسلامة",severity:"critical",status:"in_progress",isoClause:"ISO 9001 (7.1.3)",rootCause:"عدم تركيب نظام إطفاء آلي + غياب شهادة سلامة سارية من الدفاع المدني",correctiveAction:"تركيب نظام Sprinkler + الحصول على شهادة السلامة",dueDate:"30 مارس 2026",owner:"سعد الزهراني / فواز العمري",progress:35},{id:"ncr-002",code:"NCR-002",title:"استثناء العمليات الابتكارية من نظام الجودة",severity:"major",status:"in_progress",isoClause:"ISO 9001 (8.5.1)",rootCause:"عدم توثيق العمليات الابتكارية (غرفة التحفيز الحسي، العلاج بالموسيقى، التدريب المهني)",correctiveAction:"إعداد SOPs للعمليات الثلاث + رسم خرائط العمليات + تحديد KPIs",dueDate:"30 يونيو 2026",owner:"رؤساء الأقسام / أحمد الشهري",progress:20},{id:"ncr-003",code:"NCR-003",title:"انقطاع التواصل الاستراتيجي (الخيط الذهبي)",severity:"major",status:"in_progress",isoClause:"ISO 9001 (5.1)",rootCause:"غياب قنوات تواصل رسمية موثقة مع وزارة الموارد البشرية والتنمية الاجتماعية",correctiveAction:"إنشاء بروتوكول تواصل + اجتماعات دورية + تقارير أداء ربع سنوية",dueDate:"31 مارس 2026",owner:"مدير المركز",progress:45}],h=[{id:"iso-4",code:"4.0",title:"سياق المنظمة",clause:"ISO 9001:2015 - البند 4",standard:"ISO 9001:2015",status:"compliant",evidence:["مصفوفة أصحاب المصلحة","تحليل SWOT","سياق داخلي وخارجي"]},{id:"iso-5",code:"5.0",title:"القيادة والالتزام",clause:"ISO 9001:2015 - البند 5",standard:"ISO 9001:2015",status:"partial",gap:"انقطاع التواصل مع الوزارة (NCR-003)",actionPlan:"استعادة الخيط الذهبي مع HRSD",dueDate:"31 مارس 2026"},{id:"iso-6",code:"6.0",title:"التخطيط والمخاطر",clause:"ISO 9001:2015 - البند 6",standard:"ISO 9001:2015",status:"compliant",evidence:["سجل المخاطر الشامل","خطط المعالجة","مراجعة دورية"]},{id:"iso-7",code:"7.0",title:"الدعم والموارد",clause:"ISO 9001:2015 - البند 7",standard:"ISO 9001:2015",status:"non_compliant",gap:"فشل البنية التحتية للسلامة (NCR-001)",actionPlan:"تركيب نظام الإطفاء الآلي",dueDate:"30 مارس 2026"},{id:"iso-8",code:"8.0",title:"العمليات",clause:"ISO 9001:2015 - البند 8",standard:"ISO 9001:2015",status:"partial",gap:"عمليات ابتكارية غير موثقة (NCR-002)",actionPlan:"توثيق SOPs للعمليات الثلاث",dueDate:"30 يونيو 2026"},{id:"iso-9",code:"9.0",title:"تقييم الأداء",clause:"ISO 9001:2015 - البند 9",standard:"ISO 9001:2015",status:"compliant",evidence:["لوحة مؤشرات المخاطر","تدقيق داخلي مجدول","مراجعة الإدارة"]},{id:"iso-10",code:"10.0",title:"التحسين المستمر",clause:"ISO 9001:2015 - البند 10",standard:"ISO 9001:2015",status:"in_progress",actionPlan:"تنفيذ الإجراءات التصحيحية للـ NCRs الثلاث"},{id:"pdpl-1",code:"PDPL-1",title:"حماية البيانات الشخصية",clause:"نظام حماية البيانات الشخصية",standard:"PDPL",status:"partial",gap:"عدم فصل الهوية عن السجل الطبي",actionPlan:"تطبيق Pseudonymization في نظام بصيرة"},{id:"nca-1",code:"NCA-ECC",title:"ضوابط الأمن السيبراني",clause:"ضوابط الهيئة الوطنية للأمن السيبراني",standard:"NCA",status:"partial",gap:"بعض الضوابط التقنية غير مكتملة",actionPlan:"تفعيل MFA + audit logs + تشفير البيانات"}],N=[{id:"bcp-01",title:"الإخلاء الليلي الطارئ",type:"evacuation",rto:"< 5 دقائق",criticalProcess:"إخلاء 100% من المستفيدين بسلامة",strategy:"تفعيل كود أحمر + PEEPs + كراسي الإخلاء + مخزون الطوارئ",resources:["كراسي الإخلاء","ملاءات انزلاقية","صندوق الطوارئ الدوائي","بطانيات حرارية"],lastTested:"لم يُختبر بعد",status:"needs_update"},{id:"bcp-02",title:"انقطاع التيار الكهربائي",type:"infrastructure",rto:"< 10 دقائق",criticalProcess:"استمرارية التكييف والأجهزة الطبية",strategy:"تشغيل المولدات الاحتياطية + أنظمة UPS + عقود صيانة طارئة",resources:["المولدات الاحتياطية","أنظمة UPS","فريق الصيانة"],lastTested:"15 نوفمبر 2025",status:"ready"},{id:"bcp-03",title:"انقطاع إمداد الأكسجين",type:"supply",rto:"0 ساعة (فوري)",criticalProcess:"ضمان أجهزة دعم الحياة",strategy:"مخزون استراتيجي 72 ساعة + أسطوانات احتياطية + مولدات أكسجين متنقلة",resources:["مخزون الأكسجين","أسطوانات احتياطية","مولدات متنقلة"],status:"ready"},{id:"bcp-04",title:"تفشي وبائي",type:"pandemic",rto:"4 ساعات",criticalProcess:"عزل الحالات + منع الانتشار",strategy:"تفعيل سياسات العزل + مسحات فورية + تعليق الزيارات",resources:["غرف العزل","معدات الوقاية","مختبر الفحص"],lastTested:"خبرة كوفيد-19",status:"ready"},{id:"bcp-05",title:"انقطاع التغذية والمياه",type:"supply",rto:"4 ساعات",criticalProcess:"ضمان الإعاشة للمستفيدين",strategy:"خزان مياه مستقل + مخزون أغذية جافة + موردين بدلاء",resources:["خزان المياه","أغذية الطوارئ","قائمة الموردين البدلاء"],status:"ready"}],te=({risks:s,onCellClick:x})=>{const n=(a,i)=>{const l=a*i;return l>=15?"bg-gradient-to-br from-red-500 to-rose-600":l>=10?"bg-gradient-to-br from-orange-500 to-amber-600":l>=5?"bg-gradient-to-br from-yellow-500 to-amber-500":"bg-gradient-to-br from-emerald-500 to-green-600"},m=(a,i)=>s.filter(l=>l.likelihood===a&&l.impact===i);return e.jsxs(o.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-gradient-to-br from-slate-800/50 to-slate-900/50 backdrop-blur-xl rounded-3xl p-6 border border-white/10",children:[e.jsxs("h3",{className:"text-white font-bold mb-4 flex items-center gap-2 text-lg",children:[e.jsx(T,{className:"w-5 h-5 text-teal-400"}),"مصفوفة المخاطر 5×5"]}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex flex-col justify-around pl-2 py-2",children:[5,4,3,2,1].map(a=>e.jsx("span",{className:"text-gray-400 text-xs h-12 flex items-center",children:a},a))}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"grid grid-cols-5 gap-1.5",children:[5,4,3,2,1].map(a=>[1,2,3,4,5].map(i=>{const l=m(i,a);return e.jsx(o.div,{whileHover:{scale:1.1,zIndex:10},whileTap:{scale:.95},onClick:()=>x==null?void 0:x(i,a),className:`h-12 rounded-lg ${n(i,a)} flex items-center justify-center cursor-pointer shadow-lg transition-all ${l.length>0?"ring-2 ring-white/60":"opacity-60 hover:opacity-100"}`,title:`الاحتمالية: ${i}, التأثير: ${a}`,children:l.length>0&&e.jsx("span",{className:"text-white font-bold text-lg drop-shadow-lg",children:l.length})},`${i}-${a}`)}))}),e.jsx("div",{className:"flex justify-around mt-2 text-gray-400 text-xs",children:[1,2,3,4,5].map(a=>e.jsx("span",{children:a},a))}),e.jsx("p",{className:"text-center text-gray-500 text-xs mt-1",children:"الاحتمالية →"})]})]}),e.jsx("div",{className:"flex flex-wrap justify-center gap-3 mt-4 pt-4 border-t border-white/10",children:[{color:"bg-red-500",label:"حرج (15-25)"},{color:"bg-orange-500",label:"عالي (10-14)"},{color:"bg-yellow-500",label:"متوسط (5-9)"},{color:"bg-emerald-500",label:"منخفض (1-4)"}].map(({color:a,label:i})=>e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:`w-3 h-3 rounded ${a}`}),e.jsx("span",{className:"text-gray-400 text-xs",children:i})]},i))})]})},se=({risk:s,index:x})=>{const[n,m]=j.useState(!1),a=_[s.category],i=q[s.status],l=a.icon,p=i.icon,t=c=>c>=15?"border-r-red-500 bg-red-500/5":c>=10?"border-r-orange-500 bg-orange-500/5":c>=5?"border-r-amber-500 bg-amber-500/5":"border-r-emerald-500 bg-emerald-500/5",r=c=>c>=15?"from-red-500 to-rose-600":c>=10?"from-orange-500 to-amber-600":c>=5?"from-amber-500 to-yellow-600":"from-emerald-500 to-green-600";return e.jsxs(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:x*.05},layout:!0,className:`rounded-2xl border-r-4 overflow-hidden backdrop-blur-sm ${t(s.riskScore)}`,children:[e.jsx("div",{onClick:()=>m(!n),className:"p-4 cursor-pointer hover:bg-white/5 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"text-center flex-shrink-0",children:[e.jsx("div",{className:`p-3 rounded-xl bg-gradient-to-br ${a.gradient} mb-2 shadow-lg`,children:e.jsx(l,{className:"w-6 h-6 text-white"})}),e.jsx("div",{className:`text-2xl font-black bg-gradient-to-br ${r(s.riskScore)} bg-clip-text text-transparent`,children:s.riskScore}),e.jsx("div",{className:"text-gray-500 text-xs",children:"درجة"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-teal-400 font-mono text-sm",children:s.code}),e.jsxs("span",{className:`px-2 py-0.5 rounded-full text-xs ${i.bg} ${i.color} flex items-center gap-1`,children:[e.jsx(p,{className:"w-3 h-3"}),i.label]})]}),e.jsx("h4",{className:"text-white font-bold mb-1 truncate",children:s.title}),e.jsx("p",{className:"text-gray-400 text-sm line-clamp-2",children:s.description}),e.jsxs("div",{className:"flex items-center gap-4 mt-3 text-xs text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(P,{className:"w-3.5 h-3.5"}),s.owner]}),s.dueDate&&e.jsxs("span",{className:"flex items-center gap-1 text-amber-400",children:[e.jsx(I,{className:"w-3.5 h-3.5"}),s.dueDate]})]})]}),e.jsx(o.div,{animate:{rotate:n?180:0},className:"text-gray-500",children:e.jsx(z,{className:"w-5 h-5"})})]})}),e.jsx(A,{children:n&&e.jsx(o.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsxs("div",{className:"px-4 pb-4 pt-2 border-t border-white/10 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("h5",{className:"text-gray-400 text-sm mb-2 flex items-center gap-1",children:[e.jsx(T,{className:"w-4 h-4"}),"خطة المعالجة"]}),e.jsx("p",{className:"text-white text-sm",children:s.mitigationPlan})]}),e.jsxs("div",{children:[e.jsxs("h5",{className:"text-gray-400 text-sm mb-2 flex items-center gap-1",children:[e.jsx(O,{className:"w-4 h-4"}),"الضوابط الحالية"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.controls.map((c,g)=>e.jsx("span",{className:"px-2 py-1 bg-white/5 rounded-lg text-xs text-gray-300",children:c},g))})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"text-gray-500",children:[e.jsx(R,{className:"w-3.5 h-3.5 inline mr-1"}),s.isoRef]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-gray-500",children:["الاحتمالية: ",s.likelihood]}),e.jsxs("span",{className:"text-gray-500",children:["التأثير: ",s.impact]})]})]})]})})})]})},ae=({ncr:s,index:x})=>{const n=ee[s.severity];return e.jsxs(o.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:x*.1},className:"bg-gradient-to-br from-slate-800/50 to-slate-900/50 rounded-2xl p-4 border border-white/10",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-rose-400 font-mono font-bold",children:s.code}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs ${n.bg} ${n.color}`,children:n.label})]}),e.jsx("h4",{className:"text-white font-bold",children:s.title})]}),e.jsxs("div",{className:"text-left",children:[e.jsxs("div",{className:"text-2xl font-black text-teal-400",children:[s.progress,"%"]}),e.jsx("div",{className:"text-gray-500 text-xs",children:"الإنجاز"})]})]}),e.jsx("div",{className:"h-2 bg-white/10 rounded-full overflow-hidden mb-3",children:e.jsx(o.div,{initial:{width:0},animate:{width:`${s.progress}%`},transition:{duration:1,delay:x*.1},className:"h-full bg-gradient-to-r from-teal-500 to-emerald-500 rounded-full"})}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"البند: "}),e.jsx("span",{className:"text-gray-300",children:s.isoClause})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"الإجراء التصحيحي: "}),e.jsx("span",{className:"text-gray-300",children:s.correctiveAction})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-white/10",children:[e.jsxs("span",{className:"text-gray-400 flex items-center gap-1",children:[e.jsx(P,{className:"w-3.5 h-3.5"}),s.owner]}),e.jsxs("span",{className:"text-amber-400 flex items-center gap-1",children:[e.jsx(I,{className:"w-3.5 h-3.5"}),s.dueDate]})]})]})]})},le=({req:s,index:x})=>{const m=(i=>{switch(i){case"compliant":return{label:"متوافق",color:"text-emerald-400",bg:"bg-emerald-500/20",icon:k};case"non_compliant":return{label:"غير متوافق",color:"text-red-400",bg:"bg-red-500/20",icon:Q};case"partial":return{label:"جزئي",color:"text-amber-400",bg:"bg-amber-500/20",icon:$};case"in_progress":return{label:"قيد التنفيذ",color:"text-blue-400",bg:"bg-blue-500/20",icon:Y}}})(s.status),a=m.icon;return e.jsxs(o.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:x*.05},className:"bg-white/5 hover:bg-white/10 rounded-xl p-4 transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-blue-400 font-mono text-sm font-bold",children:s.code}),e.jsx("span",{className:"text-gray-500 text-xs",children:s.standard})]}),e.jsx("h4",{className:"text-white font-medium",children:s.title})]}),e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs ${m.bg} ${m.color} flex items-center gap-1`,children:[e.jsx(a,{className:"w-3 h-3"}),m.label]})]}),s.gap&&e.jsxs("div",{className:"mt-2 p-2 bg-red-500/10 rounded-lg text-sm",children:[e.jsx("span",{className:"text-red-400 font-medium",children:"الفجوة: "}),e.jsx("span",{className:"text-gray-300",children:s.gap})]}),s.actionPlan&&e.jsxs("div",{className:"mt-2 text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"خطة العمل: "}),e.jsx("span",{className:"text-gray-300",children:s.actionPlan})]}),s.evidence&&s.evidence.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:s.evidence.map((i,l)=>e.jsxs("span",{className:"px-2 py-0.5 bg-emerald-500/20 text-emerald-400 rounded text-xs",children:["✓ ",i]},l))})]})},ie=({scenario:s,index:x})=>{const n=p=>{switch(p){case"evacuation":return{icon:y,color:"text-red-400",bg:"bg-red-500/20",gradient:"from-red-500 to-rose-600"};case"pandemic":return{icon:J,color:"text-violet-400",bg:"bg-violet-500/20",gradient:"from-violet-500 to-purple-600"};case"infrastructure":return{icon:D,color:"text-amber-400",bg:"bg-amber-500/20",gradient:"from-amber-500 to-yellow-600"};case"supply":return{icon:X,color:"text-blue-400",bg:"bg-blue-500/20",gradient:"from-blue-500 to-cyan-600"}}},m=p=>{switch(p){case"ready":return{label:"جاهز",color:"text-emerald-400",bg:"bg-emerald-500/20"};case"needs_update":return{label:"يحتاج تحديث",color:"text-amber-400",bg:"bg-amber-500/20"};case"not_tested":return{label:"لم يُختبر",color:"text-red-400",bg:"bg-red-500/20"}}},a=n(s.type),i=m(s.status),l=a.icon;return e.jsxs(o.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:x*.1},whileHover:{y:-5},className:"bg-gradient-to-br from-slate-800/80 to-slate-900/80 rounded-2xl overflow-hidden border border-white/10 group",children:[e.jsx("div",{className:`bg-gradient-to-r ${a.gradient} p-4`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(l,{className:"w-8 h-8 text-white/90"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-white font-bold",children:s.title}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs ${i.bg} ${i.color}`,children:i.label})]})]}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-white/60 text-xs",children:"RTO"}),e.jsx("div",{className:"text-white font-bold text-lg",children:s.rto})]})]})}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 text-sm",children:"العملية الحرجة: "}),e.jsx("span",{className:"text-white text-sm",children:s.criticalProcess})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 text-sm",children:"الاستراتيجية: "}),e.jsx("span",{className:"text-gray-300 text-sm",children:s.strategy})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 text-sm block mb-1",children:"الموارد المطلوبة:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:s.resources.map((p,t)=>e.jsx("span",{className:"px-2 py-0.5 bg-white/5 rounded text-xs text-gray-400",children:p},t))})]}),s.lastTested&&e.jsxs("div",{className:"text-xs text-gray-500 pt-2 border-t border-white/10",children:["آخر اختبار: ",s.lastTested]})]})]})};function ce(){const[s,x]=j.useState("risks"),[n,m]=j.useState("all"),[a,i]=j.useState("all"),l=j.useMemo(()=>{const t=b.filter(d=>d.riskScore>=15).length,r=b.filter(d=>d.riskScore>=10&&d.riskScore<15).length,c=b.filter(d=>d.riskScore>=5&&d.riskScore<10).length,g=b.filter(d=>d.riskScore<5).length,v=h.filter(d=>d.status==="compliant").length,w=Math.round(v/h.length*100),f=u.filter(d=>d.status!=="closed").length,S=Math.round(u.reduce((d,F)=>d+F.progress,0)/u.length);return{totalRisks:b.length,criticalRisks:t,highRisks:r,mediumRisks:c,lowRisks:g,complianceRate:w,openNCRs:f,avgNCRProgress:S,bcpReady:N.filter(d=>d.status==="ready").length}},[]),p=j.useMemo(()=>b.filter(t=>!(n!=="all"&&t.category!==n||a!=="all"&&t.status!==a)).sort((t,r)=>r.riskScore-t.riskScore),[n,a]);return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-6",dir:"rtl",children:[e.jsxs(o.header,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-black text-white flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-teal-500 to-emerald-600 rounded-2xl shadow-lg shadow-teal-500/30",children:e.jsx(O,{className:"w-8 h-8 text-white"})}),"الحوكمة والمخاطر والامتثال"]}),e.jsx("p",{className:"text-gray-400 mt-2",children:"مركز التأهيل الشامل بالباحة | ISO 9001:2015 & ISO 31000"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(o.button,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"p-3 bg-white/5 hover:bg-white/10 rounded-xl transition-all",children:e.jsx(L,{className:"w-5 h-5 text-gray-400"})}),e.jsx(o.button,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"p-3 bg-white/5 hover:bg-white/10 rounded-xl transition-all",children:e.jsx(G,{className:"w-5 h-5 text-gray-400"})})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[{label:"المخاطر الحرجة",value:l.criticalRisks,total:l.totalRisks,color:"from-red-500 to-rose-600",icon:C,trend:"down",trendValue:"-2"},{label:"معدل الامتثال",value:`${l.complianceRate}%`,color:"from-emerald-500 to-teal-600",icon:k,trend:"up",trendValue:"+5%"},{label:"NCRs مفتوحة",value:l.openNCRs,subValue:`${l.avgNCRProgress}% متوسط الإنجاز`,color:"from-amber-500 to-orange-600",icon:R},{label:"خطط BCP جاهزة",value:`${l.bcpReady}/${N.length}`,color:"from-blue-500 to-cyan-600",icon:y}].map(({label:t,value:r,total:c,subValue:g,color:v,icon:w,trend:f,trendValue:S})=>e.jsxs(o.div,{whileHover:{scale:1.02,y:-2},className:`bg-gradient-to-br ${v} rounded-2xl p-4 text-white shadow-lg relative overflow-hidden`,children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-full bg-black/10"}),e.jsxs("div",{className:"relative",children:[e.jsx(w,{className:"w-6 h-6 mb-2 opacity-80"}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("p",{className:"text-3xl font-black",children:r}),c&&e.jsxs("span",{className:"text-white/60 text-lg mb-0.5",children:["/",c]}),f&&e.jsxs("span",{className:`flex items-center text-xs ${f==="up"?"text-emerald-300":"text-rose-300"}`,children:[f==="up"?e.jsx(B,{className:"w-3 h-3"}):e.jsx(H,{className:"w-3 h-3"}),S]})]}),e.jsx("p",{className:"text-white/80 text-sm",children:t}),g&&e.jsx("p",{className:"text-white/60 text-xs mt-1",children:g})]})]},t))})]}),e.jsx("div",{className:"flex gap-2 mb-6 overflow-x-auto pb-2",children:[{key:"risks",label:"سجل المخاطر",icon:$,count:b.length},{key:"compliance",label:"الامتثال",icon:E,count:h.length},{key:"ncr",label:"عدم المطابقة",icon:R,count:u.length},{key:"bcp",label:"استمرارية الأعمال",icon:y,count:N.length}].map(({key:t,label:r,icon:c,count:g})=>e.jsxs(o.button,{onClick:()=>x(t),whileHover:{scale:1.02},whileTap:{scale:.98},className:`flex items-center gap-2 px-5 py-3 rounded-xl font-medium transition-all whitespace-nowrap ${s===t?"bg-gradient-to-r from-teal-500 to-emerald-600 text-white shadow-lg shadow-teal-500/30":"bg-white/5 text-gray-400 hover:bg-white/10"}`,children:[e.jsx(c,{className:"w-5 h-5"}),r,e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs ${s===t?"bg-white/20":"bg-white/10"}`,children:g})]},t))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs(A,{mode:"wait",children:[s==="risks"&&e.jsxs(o.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>m("all"),className:`px-4 py-2 rounded-xl text-sm font-medium transition-all ${n==="all"?"bg-teal-500 text-white":"bg-white/10 text-gray-300 hover:bg-white/20"}`,children:"جميع الفئات"}),Object.entries(_).map(([t,{label:r,bg:c,color:g}])=>e.jsx("button",{onClick:()=>m(t),className:`px-4 py-2 rounded-xl text-sm font-medium transition-all ${n===t?`${c} ${g}`:"bg-white/10 text-gray-300 hover:bg-white/20"}`,children:r},t))]}),e.jsx("div",{className:"space-y-3",children:p.map((t,r)=>e.jsx("div",{children:e.jsx(se,{risk:t,index:r})},t.id))})]},"risks"),s==="compliance"&&e.jsxs(o.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-3 gap-3 mb-4",children:[{status:"compliant",label:"متوافق",count:h.filter(t=>t.status==="compliant").length},{status:"partial",label:"جزئي",count:h.filter(t=>t.status==="partial").length},{status:"non_compliant",label:"غير متوافق",count:h.filter(t=>t.status==="non_compliant").length}].map(({status:t,label:r,count:c})=>e.jsxs("div",{className:`p-3 rounded-xl text-center ${t==="compliant"?"bg-emerald-500/20":t==="partial"?"bg-amber-500/20":"bg-red-500/20"}`,children:[e.jsx("div",{className:`text-2xl font-bold ${t==="compliant"?"text-emerald-400":t==="partial"?"text-amber-400":"text-red-400"}`,children:c}),e.jsx("div",{className:"text-gray-400 text-sm",children:r})]},t))}),e.jsx("div",{className:"space-y-2",children:h.map((t,r)=>e.jsx("div",{children:e.jsx(le,{req:t,index:r})},t.id))})]},"compliance"),s==="ncr"&&e.jsxs(o.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"space-y-4",children:[e.jsxs("div",{className:"bg-gradient-to-r from-rose-500/20 to-red-500/20 rounded-2xl p-4 border border-rose-500/30",children:[e.jsxs("h3",{className:"text-white font-bold mb-2 flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5 text-rose-400"}),"حالات عدم المطابقة الرئيسية (NCRs)"]}),e.jsxs("p",{className:"text-gray-400 text-sm",children:[u.length," حالات مفتوحة | متوسط الإنجاز: ",l.avgNCRProgress,"%"]})]}),e.jsx("div",{className:"space-y-4",children:u.map((t,r)=>e.jsx("div",{children:e.jsx(ae,{ncr:t,index:r})},t.id))})]},"ncr"),s==="bcp"&&e.jsxs(o.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"space-y-4",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-500/20 to-cyan-500/20 rounded-2xl p-4 border border-blue-500/30",children:[e.jsxs("h3",{className:"text-white font-bold mb-2 flex items-center gap-2",children:[e.jsx(y,{className:"w-5 h-5 text-blue-400"}),"خطط استمرارية الأعمال (BCP) - ISO 22301"]}),e.jsxs("p",{className:"text-gray-400 text-sm",children:[l.bcpReady," من ",N.length," سيناريوهات جاهزة للتفعيل"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:N.map((t,r)=>e.jsx("div",{children:e.jsx(ie,{scenario:t,index:r})},t.id))})]},"bcp")]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(te,{risks:b}),e.jsxs(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-gradient-to-br from-slate-800/50 to-slate-900/50 backdrop-blur-xl rounded-3xl p-6 border border-white/10",children:[e.jsxs("h3",{className:"text-white font-bold mb-4 flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5 text-purple-400"}),"ملخص الامتثال ISO 9001"]}),e.jsx("div",{className:"relative pt-4",children:e.jsxs("div",{className:"w-32 h-32 mx-auto relative",children:[e.jsxs("svg",{className:"w-full h-full transform -rotate-90",children:[e.jsx("circle",{cx:"64",cy:"64",r:"56",fill:"none",stroke:"rgba(255,255,255,0.1)",strokeWidth:"12"}),e.jsx(o.circle,{cx:"64",cy:"64",r:"56",fill:"none",stroke:"url(#complianceGradient)",strokeWidth:"12",strokeLinecap:"round",initial:{strokeDasharray:"0 352"},animate:{strokeDasharray:`${l.complianceRate/100*352} 352`},transition:{duration:1.5,ease:"easeOut"}}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"complianceGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#14b8a6"}),e.jsx("stop",{offset:"100%",stopColor:"#10b981"})]})})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("span",{className:"text-3xl font-black text-white",children:[l.complianceRate,"%"]}),e.jsx("p",{className:"text-gray-500 text-xs",children:"متوافق"})]})})]})}),e.jsx("div",{className:"space-y-2 mt-4",children:[{label:"متوافق",count:h.filter(t=>t.status==="compliant").length,color:"bg-emerald-500"},{label:"جزئي",count:h.filter(t=>t.status==="partial").length,color:"bg-amber-500"},{label:"غير متوافق",count:h.filter(t=>t.status==="non_compliant").length,color:"bg-red-500"},{label:"قيد التنفيذ",count:h.filter(t=>t.status==="in_progress").length,color:"bg-blue-500"}].map(({label:t,count:r,color:c})=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-3 h-3 rounded-full ${c}`}),e.jsx("span",{className:"text-gray-300 text-sm",children:t})]}),e.jsx("span",{className:"text-white font-bold",children:r})]},t))})]}),e.jsxs(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-gradient-to-br from-slate-800/50 to-slate-900/50 backdrop-blur-xl rounded-3xl p-6 border border-white/10",children:[e.jsxs("h3",{className:"text-white font-bold mb-4 flex items-center gap-2",children:[e.jsx(I,{className:"w-5 h-5 text-amber-400"}),"خارطة الطريق للاعتماد"]}),e.jsx("div",{className:"space-y-4",children:[{month:"يناير 2026",task:"تقييم الدفاع المدني + SOPs",status:"current"},{month:"فبراير",task:"ترسية عقد الإطفاء + اعتماد SOPs",status:"pending"},{month:"مارس",task:"إغلاق NCR-001 + NCR-003",status:"pending"},{month:"أبريل",task:"تجربة إخلاء + تدقيق جزئي",status:"pending"},{month:"مايو",task:"تدقيق داخلي شامل",status:"pending"},{month:"يونيو",task:"مراجعة الإدارة + الجاهزية النهائية",status:"pending"}].map(({month:t,task:r,status:c},g)=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full mt-1.5 ${c==="current"?"bg-teal-500 animate-pulse":"bg-white/20"}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:`font-medium ${c==="current"?"text-teal-400":"text-gray-400"}`,children:t}),e.jsx("div",{className:"text-gray-500 text-sm",children:r})]})]},t))})]})]})]})]})}export{ce as GRCDashboard,ce as default};
